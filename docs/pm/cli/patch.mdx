---
title: "bun patch"
description: "以对 git 友好的方式持久化修补 node_modules 包"
---

import Patch from "/snippets/cli/patch.mdx";

`bun patch` 让你可以以一种可维护且对 git 友好的方式持久化修补 node_modules。

有时，你需要对 `node_modules/` 中的某个包进行小幅修改，以修复bug或添加功能。`bun patch` 让这个过程变得简单，无需整体供应包，并且能跨多次安装、多个项目和多台机器复用补丁。

功能特点：

- 生成应用于 `node_modules` 依赖的 `.patch` 文件（在安装时生效）
- `.patch` 文件可以提交到你的仓库，跨多次安装、项目和机器复用
- `package.json` 中的 `"patchedDependencies"` 用以追踪已修补的包
- `bun patch` 允许你对 `node_modules/` 中的包进行补丁修改，同时保持 Bun [全局缓存](/pm/global-cache) 的完整性
- 使用 `bun patch --commit <pkg>` 可在提交补丁前，本地测试修改
- 为节省磁盘空间并保持 `bun install` 的速度，修补的包会提交到全局缓存，并在可能的情况下跨项目共享

#### 第 1 步. 准备包进行补丁

开始时，使用 `bun patch <pkg>` 来准备补丁包：

```bash terminal icon="terminal"
# 你可以直接提供包名
bun patch react

# 如果安装了多个版本，可以指定精确版本
bun patch react@17.0.2

# 也可以提供包的路径
bun patch node_modules/react
```

<Note>
别忘了执行 `bun patch <pkg>`！这一步可确保 `node_modules/` 中的包文件夹包含一份不带软链接/硬链接至 Bun 缓存的全新副本。

如果忘记执行这步，你可能会误修改全局缓存中的包！

</Note>

#### 第 2 步. 本地测试你的修改

`bun patch <pkg>` 允许你直接安全地编辑 `node_modules/` 中的 `<pkg>`，同时保全 Bun [全局缓存](/pm/global-cache) 的完整性。其原理是在 `node_modules/` 中重新创建一个未链接的克隆版本，并与全局缓存中的原始包做差异比对。

#### 第 3 步. 提交修改

当你满意修改后，执行 `bun patch --commit <路径或包名>`。

Bun 会在 `patches/` 生成补丁文件，更新你的 `package.json` 和锁文件，随后 Bun 会开始使用补丁包：

```bash terminal icon="terminal"
# 你可以提供已修补包的路径
bun patch --commit node_modules/react

# 或只是包名，外加可选版本号
bun patch --commit react@17.0.2

# 指定存放补丁文件的目录
bun patch --commit react --patches-dir=mypatches

# 为兼容 pnpm，可使用 patch-commit
bun patch-commit react
```

---

<Patch />

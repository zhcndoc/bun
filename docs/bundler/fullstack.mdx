---
title: "å…¨æ ˆå¼€å‘æœåŠ¡å™¨"
description: "ä½¿ç”¨ Bun é›†æˆçš„å¼€å‘æœåŠ¡å™¨æ„å»ºå…¨æ ˆåº”ç”¨ï¼Œå®ƒèƒ½å¤Ÿæ‰“åŒ…å‰ç«¯èµ„æºå¹¶å¤„ç† API è·¯ç”±"
---

é¦–å…ˆï¼Œå¯¼å…¥ HTML æ–‡ä»¶å¹¶å°†å®ƒä»¬ä¼ é€’ç»™ `Bun.serve()` çš„ `routes` é€‰é¡¹ã€‚

```ts title="app.ts" icon="/icons/typescript.svg"
import { serve } from "bun";
import dashboard from "./dashboard.html";
import homepage from "./index.html";

const server = serve({
  routes: {
    // ** HTML å¯¼å…¥ **
    // å°† index.html æ‰“åŒ…å¹¶è·¯ç”±åˆ° "/"
    // è¿™ä½¿ç”¨ HTMLRewriter æ‰«æ HTML ä¸­çš„ `<script>` å’Œ `<link>` æ ‡ç­¾ï¼Œ
    // å¯¹å®ƒä»¬è¿è¡Œ Bun çš„ JavaScript å’Œ CSS æ‰“åŒ…å™¨ï¼Œ
    // è½¬è¯‘ä»»ä½• TypeScriptã€JSX å’Œ TSXï¼Œ
    // ä½¿ç”¨ Bun çš„ CSS è§£æå™¨é™ä½ CSS çº§åˆ«å¹¶æä¾›ç»“æœã€‚
    "/": homepage,
    // å°† dashboard.html æ‰“åŒ…å¹¶è·¯ç”±åˆ° "/dashboard"
    "/dashboard": dashboard,

    // ** API ç«¯ç‚¹ ** (éœ€ Bun v1.2.3+)
    "/api/users": {
      async GET(req) {
        const users = await sql`SELECT * FROM users`;
        return Response.json(users);
      },
      async POST(req) {
        const { name, email } = await req.json();
        const [user] = await sql`INSERT INTO users (name, email) VALUES (${name}, ${email})`;
        return Response.json(user);
      },
    },
    "/api/users/:id": async req => {
      const { id } = req.params;
      const [user] = await sql`SELECT * FROM users WHERE id = ${id}`;
      return Response.json(user);
    },
  },

  // å¯ç”¨å¼€å‘æ¨¡å¼ä»¥è·å¾—ï¼š
  // - è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
  // - çƒ­é‡è½½ï¼ˆéœ€è¦ Bun v1.2.3+ï¼‰
  development: true,
});

console.log(`Listening on ${server.url}`);
```

```bash terminal icon="terminal"
bun run app.ts
```

## HTML è·¯ç”±

### å°† HTML å¯¼å…¥ä½œä¸ºè·¯ç”±

Web ä»¥ HTML å¼€å§‹ï¼ŒBun çš„å…¨æ ˆå¼€å‘æœåŠ¡å™¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

è¦æŒ‡å®šå‰ç«¯å…¥å£ç‚¹ï¼Œè¯·å°† HTML æ–‡ä»¶å¯¼å…¥åˆ°ä½ çš„ JavaScript/TypeScript/TSX/JSX æ–‡ä»¶ä¸­ã€‚

```ts title="app.ts" icon="/icons/typescript.svg"
import dashboard from "./dashboard.html";
import homepage from "./index.html";
```

è¿™äº› HTML æ–‡ä»¶è¢«ç”¨ä½œ Bun å¼€å‘æœåŠ¡å™¨ä¸­çš„è·¯ç”±ï¼Œä¼ é€’ç»™ `Bun.serve()`ã€‚

```ts title="app.ts" icon="/icons/typescript.svg"
Bun.serve({
  routes: {
    "/": homepage,
    "/dashboard": dashboard,
  },

  fetch(req) {
    // ... API è¯·æ±‚
  },
});
```

å½“ä½ è¯·æ±‚ `/dashboard` æˆ– `/` æ—¶ï¼ŒBun ä¼šè‡ªåŠ¨æ‰“åŒ… HTML æ–‡ä»¶ä¸­çš„ `<script>` å’Œ `<link>` æ ‡ç­¾ï¼Œå°†å®ƒä»¬æš´éœ²ä¸ºé™æ€è·¯ç”±å¹¶æä¾›ç»“æœã€‚

### HTML å¤„ç†ç¤ºä¾‹

ä¸€ä¸ª `index.html` æ–‡ä»¶å¦‚ä¸‹ï¼š

```html title="index.html" icon="file-code"
<!DOCTYPE html>
<html>
  <head>
    <title>Home</title>
    <link rel="stylesheet" href="./reset.css" />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="./sentry-and-preloads.ts"></script>
    <script type="module" src="./my-app.tsx"></script>
  </body>
</html>
```

ç»è¿‡å¤„ç†åå¯èƒ½æˆä¸ºï¼š

```html title="index.html" icon="file-code"
<!DOCTYPE html>
<html>
  <head>
    <title>Home</title>
    <link rel="stylesheet" href="/index-[hash].css" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/index-[hash].js"></script>
  </body>
</html>
```

## React é›†æˆ

è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ä½¿ç”¨ Reactï¼Œå¯¼å…¥ `react-dom/client` å¹¶æ¸²æŸ“ä½ çš„åº”ç”¨ã€‚

<CodeGroup>
```ts title="src/backend.ts" icon="/icons/typescript.svg"
import dashboard from "../public/dashboard.html";
import { serve } from "bun";

serve({
routes: {
"/": dashboard,
},
async fetch(req) {
// ...api è¯·æ±‚
return new Response("hello world");
},
});
````

```tsx title="src/frontend.tsx" icon="/icons/typescript.svg"
import { createRoot } from 'react-dom/client';
import App from './app';

const container = document.getElementById('root');
const root = createRoot(container!);
root.render(<App />);
````

```html title="public/dashboard.html" icon="file-code"
<!DOCTYPE html>
<html>
  <head>
    <title>Dashboard</title>
    <link rel="stylesheet" href="../src/styles.css" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="../src/frontend.tsx"></script>
  </body>
</html>
```

```tsx title="src/app.tsx" icon="/icons/typescript.svg"
import { useState } from "react";

export default function App() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <h1>Dashboard</h1>
      <button onClick={() => setCount(count + 1)}>Count: {count}</button>
    </div>
  );
}
```

</CodeGroup>

## å¼€å‘æ¨¡å¼

æœ¬åœ°å¼€å‘æ—¶ï¼Œé€šè¿‡åœ¨ `Bun.serve()` ä¸­è®¾ç½® `development: true` å¯ç”¨å¼€å‘æ¨¡å¼ã€‚

```ts title="src/backend.ts" icon="/icons/typescript.svg"
import homepage from "./index.html";
import dashboard from "./dashboard.html";

Bun.serve({
  routes: {
    "/": homepage,
    "/dashboard": dashboard,
  },

  development: true,

  fetch(req) {
    // ... API è¯·æ±‚
  },
});
```

### å¼€å‘æ¨¡å¼åŠŸèƒ½

å½“ `development` ä¸º `true` æ—¶ï¼ŒBun ä¼šï¼š

- åœ¨å“åº”ä¸­åŒ…å« SourceMap å¤´ï¼Œæ–¹ä¾¿è°ƒè¯•å·¥å…·æ˜¾ç¤ºåŸå§‹æºç 
- ç¦ç”¨ä»£ç å‹ç¼©
- æ¯æ¬¡è¯·æ±‚ `.html` æ–‡ä»¶æ—¶é‡æ–°æ‰“åŒ…èµ„æº
- å¯ç”¨çƒ­æ¨¡å—é‡è½½ï¼ˆé™¤éè®¾ç½® `hmr: false`ï¼‰
- å°†æµè§ˆå™¨ä¸­çš„æ§åˆ¶å°æ—¥å¿—å›æ˜¾åˆ°ç»ˆç«¯

### é«˜çº§å¼€å‘é…ç½®

`Bun.serve()` æ”¯æŒå°†æµè§ˆå™¨ä¸­çš„æ§åˆ¶å°æ—¥å¿—å›æ˜¾åˆ°ç»ˆç«¯ã€‚

è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œåœ¨ `Bun.serve()` çš„å¼€å‘æ¨¡å¼å¯¹è±¡ä¸­ä¼ é€’ `console: true`ã€‚

```ts title="src/backend.ts" icon="/icons/typescript.svg"
import homepage from "./index.html";

Bun.serve({
  // development ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡
  development: {
    // å¯ç”¨çƒ­æ¨¡å—é‡è½½
    hmr: true,

    // å°†æµè§ˆå™¨ä¸­çš„æ§åˆ¶å°æ—¥å¿—å›æ˜¾åˆ°ç»ˆç«¯
    console: true,
  },

  routes: {
    "/": homepage,
  },
});
```

è®¾ç½® `console: true` åï¼ŒBun ä¼šé€šè¿‡çƒ­æ¨¡å—é‡è½½çš„ WebSocket è¿æ¥å°†æµè§ˆå™¨çš„æ—¥å¿—æµå¼ä¼ è¾“åˆ°ç»ˆç«¯ã€‚

### å¼€å‘ vs ç”Ÿäº§

| åŠŸèƒ½                 | å¼€å‘ç¯å¢ƒ              | ç”Ÿäº§ç¯å¢ƒ   |
| ------------------- | --------------------- | ----------- |
| **Source maps**     | âœ… å¯ç”¨               | âŒ ç¦ç”¨     |
| **ä»£ç å‹ç¼©**         | âŒ ç¦ç”¨               | âœ… å¯ç”¨     |
| **çƒ­é‡è½½**           | âœ… å¯ç”¨               | âŒ ç¦ç”¨     |
| **èµ„æºæ‰“åŒ…**         | ğŸ”„ æ¯æ¬¡è¯·æ±‚           | ğŸ’¾ ç¼“å­˜     |
| **æ§åˆ¶å°æ—¥å¿—**       | ğŸ–¥ï¸ æµè§ˆå™¨ â†’ ç»ˆç«¯     | âŒ ç¦ç”¨     |
| **é”™è¯¯è¯¦æƒ…**         | ğŸ“ è¯¦ç»†               | ğŸ”’ ç®€æ´     |

## ç”Ÿäº§æ¨¡å¼

çƒ­é‡è½½å’Œ `development: true` æœ‰åŠ©äºå¿«é€Ÿè¿­ä»£ï¼Œä½†ç”Ÿäº§ç¯å¢ƒä¸‹ä½ çš„æœåŠ¡å™¨åº”å°½å¯èƒ½å¿«é€Ÿä¸”ä¾èµ–å°½å¯èƒ½å°‘ã€‚

### é¢„æ„å»ºæ‰“åŒ…ï¼ˆæ¨èï¼‰

ä» Bun v1.2.17 å¼€å§‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ `Bun.build` æˆ– `bun build` é¢„å…ˆæ‰“åŒ…å…¨æ ˆåº”ç”¨ã€‚

```bash terminal icon="terminal"
bun build --target=bun --production --outdir=dist ./src/index.ts
```

å½“ Bun çš„æ‰“åŒ…å™¨æ£€æµ‹åˆ°æœåŠ¡å™¨ç«¯ä»£ç ä¸­å¯¼å…¥ HTML æ–‡ä»¶æ—¶ï¼Œä¼šå°†å¼•ç”¨çš„ JS/TS/TSX/JSX å’Œ CSS æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª `Bun.serve()` å¯ç”¨çš„æ¸…å•å¯¹è±¡ã€‚

```ts title="src/backend.ts" icon="/icons/typescript.svg"
import { serve } from "bun";
import index from "./index.html";

serve({
  routes: { "/": index },
});
```

### è¿è¡Œæ—¶æ‰“åŒ…

å½“æ„å»ºæ­¥éª¤å¤ªå¤æ‚æ—¶ï¼Œä½ å¯ä»¥åœ¨ `Bun.serve()` è®¾ç½® `development: false`ã€‚

è¿™å°†ï¼š

- å¯ç”¨å†…å­˜ä¸­ç¼“å­˜æ‰“åŒ…èµ„æºã€‚é¦–æ¬¡è¯·æ±‚ `.html` æ–‡ä»¶æ—¶ Bun è‡ªè¡Œæ‰“åŒ…ï¼Œå¹¶ç¼“å­˜ç»“æœç›´åˆ°æœåŠ¡å™¨é‡å¯ã€‚
- å¯ç”¨ `Cache-Control` ä»¥åŠ `ETag` å¤´
- å‹ç¼© JavaScript/TypeScript/TSX/JSX æ–‡ä»¶

```ts title="src/backend.ts" icon="/icons/typescript.svg"
import { serve } from "bun";
import homepage from "./index.html";

serve({
  routes: {
    "/": homepage,
  },

  // ç”Ÿäº§æ¨¡å¼
  development: false,
});
```

## API è·¯ç”±

### HTTP æ–¹æ³•å¤„ç†å™¨

é€šè¿‡ HTTP æ–¹æ³•å¤„ç†å™¨å®šä¹‰ API ç«¯ç‚¹ï¼š

```ts title="src/backend.ts" icon="/icons/typescript.svg"
import { serve } from "bun";

serve({
  routes: {
    "/api/users": {
      async GET(req) {
        // å¤„ç† GET è¯·æ±‚
        const users = await getUsers();
        return Response.json(users);
      },

      async POST(req) {
        // å¤„ç† POST è¯·æ±‚
        const userData = await req.json();
        const user = await createUser(userData);
        return Response.json(user, { status: 201 });
      },

      async PUT(req) {
        // å¤„ç† PUT è¯·æ±‚
        const userData = await req.json();
        const user = await updateUser(userData);
        return Response.json(user);
      },

      async DELETE(req) {
        // å¤„ç† DELETE è¯·æ±‚
        await deleteUser(req.params.id);
        return new Response(null, { status: 204 });
      },
    },
  },
});
```

### åŠ¨æ€è·¯ç”±

è·¯ç”±ä¸­ä½¿ç”¨ URL å‚æ•°ï¼š

```ts title="src/backend.ts" icon="/icons/typescript.svg"
serve({
  routes: {
    // å•å‚æ•°
    "/api/users/:id": async req => {
      const { id } = req.params;
      const user = await getUserById(id);
      return Response.json(user);
    },

    // å¤šå‚æ•°
    "/api/users/:userId/posts/:postId": async req => {
      const { userId, postId } = req.params;
      const post = await getPostByUser(userId, postId);
      return Response.json(post);
    },

    // é€šé…ç¬¦è·¯ç”±
    "/api/files/*": async req => {
      const filePath = req.params["*"];
      const file = await getFile(filePath);
      return new Response(file);
    },
  },
});
```

### è¯·æ±‚å¤„ç†

```ts title="src/backend.ts" icon="/icons/typescript.svg"
serve({
  routes: {
    "/api/data": {
      async POST(req) {
        // è§£æ JSON è¯·æ±‚ä½“
        const body = await req.json();

        // è®¿é—®è¯·æ±‚å¤´
        const auth = req.headers.get("Authorization");

        // è®¿é—® URL å‚æ•°
        const { id } = req.params;

        // è®¿é—®æŸ¥è¯¢å‚æ•°
        const url = new URL(req.url);
        const page = url.searchParams.get("page") || "1";

        // è¿”å›å“åº”
        return Response.json({
          message: "Data processed",
          page: parseInt(page),
          authenticated: !!auth,
        });
      },
    },
  },
});
```

## æ’ä»¶

Bun çš„æ‰“åŒ…å™¨æ’ä»¶åœ¨æ‰“åŒ…é™æ€è·¯ç”±æ—¶åŒæ ·æ”¯æŒã€‚

è¦ä¸º `Bun.serve` é…ç½®æ’ä»¶ï¼Œåœ¨ `bunfig.toml` çš„ `[serve.static]` éƒ¨åˆ†æ·»åŠ  `plugins` æ•°ç»„ã€‚

### TailwindCSS æ’ä»¶

ä½ å¯ä»¥é€šè¿‡å®‰è£… `tailwindcss` åŒ…å’Œ `bun-plugin-tailwind` æ’ä»¶ä½¿ç”¨ TailwindCSSã€‚

```bash terminal icon="terminal"
bun add tailwindcss bun-plugin-tailwind
```

```toml title="bunfig.toml" icon="settings"
[serve.static]
plugins = ["bun-plugin-tailwind"]
```

è¿™æ ·ä½ å°±å¯ä»¥åœ¨ HTML å’Œ CSS æ–‡ä»¶ä¸­ä½¿ç”¨ TailwindCSS å®ç”¨ç±»ã€‚åªéœ€åœ¨æŸå¤„å¯¼å…¥ `tailwindcss`ï¼š

```html title="index.html" icon="file-code"
<!doctype html>
<html>
  <head>
    <!-- [!code ++] -->
    <link rel="stylesheet" href="tailwindcss" />
  </head>
  <!-- å…¶ä½™ HTML... -->
</html>
```

æˆ–è€…åœ¨ CSS æ–‡ä»¶ä¸­å¯¼å…¥ TailwindCSSï¼š

```css title="style.css" icon="file-code"
@import "tailwindcss";

.custom-class {
  @apply bg-red-500 text-white;
}
```

```html index.html icon="file-code"
<!doctype html>
<html>
  <head>
    <!-- [!code ++] -->
    <link rel="stylesheet" href="./style.css" />
  </head>
  <!-- å…¶ä½™ HTML... -->
</html>
```

### è‡ªå®šä¹‰æ’ä»¶

ä»»ä½•å¯¼å‡ºæœ‰æ•ˆæ‰“åŒ…å™¨æ’ä»¶å¯¹è±¡ï¼ˆåŸºæœ¬åŒ…å« `name` å’Œ `setup` å­—æ®µï¼‰çš„ JS æ–‡ä»¶æˆ–æ¨¡å—ï¼Œéƒ½å¯ä»¥æ”¾å…¥æ’ä»¶æ•°ç»„ï¼š

```toml title="bunfig.toml" icon="settings"
[serve.static]
plugins = ["./my-plugin-implementation.ts"]
```

```ts title="my-plugin-implementation.ts" icon="/icons/typescript.svg"
import type { BunPlugin } from "bun";

const myPlugin: BunPlugin = {
  name: "my-custom-plugin",
  setup(build) {
    // æ’ä»¶å®ç°
    build.onLoad({ filter: /\.custom$/ }, async args => {
      const text = await Bun.file(args.path).text();
      return {
        contents: `export default ${JSON.stringify(text)};`,
        loader: "js",
      };
    });
  },
};

export default myPlugin;
```

Bun ä¼šå»¶è¿Ÿè§£æå’ŒåŠ è½½æ¯ä¸ªæ’ä»¶ï¼Œå¹¶ä½¿ç”¨å®ƒä»¬æ‰“åŒ…ä½ çš„è·¯ç”±ã€‚

<Note>
  è¿™å½“å‰å†™åœ¨ `bunfig.toml` ä¸­ï¼Œæ˜¯ä¸ºäº†åœ¨æœªæ¥æ•´åˆ `bun build` CLI æ—¶èƒ½é™æ€è·çŸ¥æ‰€ç”¨æ’ä»¶ã€‚è¿™äº›æ’ä»¶å¯åœ¨ `Bun.build()` JS API ä¸‹å·¥ä½œï¼Œä½† CLI å°šæœªæ”¯æŒã€‚
</Note>

## å†…è”ç¯å¢ƒå˜é‡

Bun å¯ä»¥åœ¨æ„å»ºæ—¶å°†å‰ç«¯ JavaScript å’Œ TypeScript ä¸­çš„ `process.env.*` æ›¿æ¢ä¸ºå®é™…å€¼ã€‚åœ¨ `bunfig.toml` ä¸­é…ç½® `env` é€‰é¡¹ï¼š

```toml title="bunfig.toml" icon="settings"
[serve.static]
env = "PUBLIC_*"  # ä»…å†…è”ä»¥ PUBLIC_ å¼€å¤´çš„ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰
# env = "inline"  # å†…è”æ‰€æœ‰ç¯å¢ƒå˜é‡
# env = "disable" # ç¦ç”¨ç¯å¢ƒå˜é‡æ›¿æ¢ï¼ˆé»˜è®¤ï¼‰
```

<Note>
  ä»…é€‚ç”¨äºå­—é¢é‡ `process.env.FOO` å¼•ç”¨ï¼Œä¸æ”¯æŒ `import.meta.env` æˆ–é—´æ¥è®¿é—®å¦‚ `const env = process.env; env.FOO`ã€‚

å¦‚æœç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šæŠ¥é”™ï¼Œå¦‚ `ReferenceError: process is not defined`ã€‚
</Note>

è¯¦æƒ…åŠç¤ºä¾‹è¯·å‚è§ [HTML & é™æ€ç«™ç‚¹æ–‡æ¡£](/bundler/html-static#inline-environment-variables)ã€‚

## å·¥ä½œåŸç†

Bun ä½¿ç”¨ `HTMLRewriter` æ‰«æ HTML æ–‡ä»¶ä¸­çš„ `<script>` å’Œ `<link>` æ ‡ç­¾ï¼Œä½œä¸º Bun æ‰“åŒ…å™¨å…¥å£ç‚¹ï¼Œç”Ÿæˆé’ˆå¯¹ JS/TS/TSX/JSX åŠ CSS çš„ä¼˜åŒ–åŒ…ï¼Œå¹¶æä¾›ç»“æœã€‚

### å¤„ç†æµç¨‹

<Steps>
<Step title="1. <script> å¤„ç†">
- è½¬è¯‘ `<script>` æ ‡ç­¾ä¸­çš„ TypeScriptã€JSX å’Œ TSX
- æ‰“åŒ…å¯¼å…¥çš„ä¾èµ–
- ç”Ÿæˆç”¨äºè°ƒè¯•çš„ sourcemap
- åœ¨ `Bun.serve()` ä¸­ `development` é `true` æ—¶è¿›è¡Œä»£ç å‹ç¼©

```html title="index.html" icon="file-code"
<script type="module" src="./counter.tsx"></script>
```

</Step>
<Step title="2. <link> å¤„ç†">
- å¤„ç† CSS å¯¼å…¥åŠ `<link>` æ ‡ç­¾
- åˆå¹¶ CSS æ–‡ä»¶
- é‡å†™ url åŠèµ„æºè·¯å¾„ï¼Œåœ¨ URL ä¸­åŠ å…¥å†…å®¹å¯»å€å“ˆå¸Œ

```html title="index.html" icon="file-code"
<link rel="stylesheet" href="./styles.css" />
```

</Step>
<Step title="3. <img> ä¸èµ„æºå¤„ç†">
- èµ„æºé“¾æ¥è¢«é‡å†™ä»¥åŒ…å«å†…å®¹å¯»å€å“ˆå¸Œ
- CSS æ–‡ä»¶ä¸­çš„å°èµ„æºè¢«å†…è”ä¸º `data:` URLï¼Œå‡å°‘ HTTP è¯·æ±‚æ•°é‡
</Step>
<Step title="4. HTML é‡å†™">
- åˆå¹¶æ‰€æœ‰ `<script>` æ ‡ç­¾ä¸ºä¸€ä¸ªå¸¦å†…å®¹å¯»å€å“ˆå¸Œçš„ `<script>` æ ‡ç­¾
- åˆå¹¶æ‰€æœ‰ `<link>` æ ‡ç­¾ä¸ºä¸€ä¸ªå¸¦å†…å®¹å¯»å€å“ˆå¸Œçš„ `<link>` æ ‡ç­¾
- è¾“å‡ºæ–°çš„ HTML æ–‡ä»¶
</Step>
<Step title="5. æä¾›æœåŠ¡">
- æ‰€æœ‰æ‰“åŒ…è¾“å‡ºçš„æ–‡ä»¶éƒ½ä½œä¸ºé™æ€è·¯ç”±æš´éœ²ï¼Œå†…éƒ¨ä½¿ç”¨ä¸ä¼ é€’ Response å¯¹è±¡ç»™ `Bun.serve()` ä¸­ `static` ç›¸åŒæœºåˆ¶
- è¡Œä¸ºç±»ä¼¼äº `Bun.build` å¯¹ HTML æ–‡ä»¶çš„å¤„ç†æ–¹å¼
</Step>
</Steps>

## å®Œæ•´ç¤ºä¾‹

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å…¨æ ˆåº”ç”¨ç¤ºä¾‹ï¼š

```ts title="server.ts" icon="/icons/typescript.svg"
import { serve } from "bun";
import { Database } from "bun:sqlite";
import homepage from "./public/index.html";
import dashboard from "./public/dashboard.html";

// åˆå§‹åŒ–æ•°æ®åº“
const db = new Database("app.db");
db.exec(`
  CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
  )
`);

const server = serve({
  routes: {
    // å‰ç«¯è·¯ç”±
    "/": homepage,
    "/dashboard": dashboard,

    // API è·¯ç”±
    "/api/users": {
      async GET() {
        const users = db.query("SELECT * FROM users").all();
        return Response.json(users);
      },

      async POST(req) {
        const { name, email } = await req.json();

        try {
          const result = db.query("INSERT INTO users (name, email) VALUES (?, ?) RETURNING *").get(name, email);

          return Response.json(result, { status: 201 });
        } catch (error) {
          return Response.json({ error: "Email already exists" }, { status: 400 });
        }
      },
    },

    "/api/users/:id": {
      async GET(req) {
        const { id } = req.params;
        const user = db.query("SELECT * FROM users WHERE id = ?").get(id);

        if (!user) {
          return Response.json({ error: "User not found" }, { status: 404 });
        }

        return Response.json(user);
      },

      async DELETE(req) {
        const { id } = req.params;
        const result = db.query("DELETE FROM users WHERE id = ?").run(id);

        if (result.changes === 0) {
          return Response.json({ error: "User not found" }, { status: 404 });
        }

        return new Response(null, { status: 204 });
      },
    },

    // å¥åº·æ£€æŸ¥ç«¯ç‚¹
    "/api/health": {
      GET() {
        return Response.json({
          status: "ok",
          timestamp: new Date().toISOString(),
        });
      },
    },
  },

  // å¯ç”¨å¼€å‘æ¨¡å¼
  development: {
    hmr: true,
    console: true,
  },

  // æœªåŒ¹é…è·¯ç”±æ—¶å›é€€
  fetch(req) {
    return new Response("Not Found", { status: 404 });
  },
});

console.log(`ğŸš€ Server running on ${server.url}`);
```

```html title="public/index.html" icon="file-code"
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Fullstack Bun App</title>
    <link rel="stylesheet" href="../src/styles.css" />
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="../src/main.tsx"></script>
  </body>
</html>
```

```tsx title="src/main.tsx"
import { createRoot } from "react-dom/client";
import { App } from "./App";

const container = document.getElementById("root")!;
const root = createRoot(container);
root.render(<App />);
```

```tsx title="src/App.tsx"
import { useState, useEffect } from "react";

interface User {
  id: number;
  name: string;
  email: string;
  created_at: string;
}

export function App() {
  const [users, setUsers] = useState<User[]>([]);
  const [name, setName] = useState("");
  const [email, setEmail] = useState("");
  const [loading, setLoading] = useState(false);

  const fetchUsers = async () => {
    const response = await fetch("/api/users");
    const data = await response.json();
    setUsers(data);
  };

  const createUser = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const response = await fetch("/api/users", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email }),
      });

      if (response.ok) {
        setName("");
        setEmail("");
        await fetchUsers();
      } else {
        const error = await response.json();
        alert(error.error);
      }
    } catch (error) {
      alert("Failed to create user");
    } finally {
      setLoading(false);
    }
  };

  const deleteUser = async (id: number) => {
    if (!confirm("Are you sure?")) return;

    try {
      const response = await fetch(`/api/users/${id}`, {
        method: "DELETE",
      });

      if (response.ok) {
        await fetchUsers();
      }
    } catch (error) {
      alert("Failed to delete user");
    }
  };

  useEffect(() => {
    fetchUsers();
  }, []);

  return (
    <div className="container">
      <h1>User Management</h1>

      <form onSubmit={createUser} className="form">
        <input type="text" placeholder="Name" value={name} onChange={e => setName(e.target.value)} required />
        <input type="email" placeholder="Email" value={email} onChange={e => setEmail(e.target.value)} required />
        <button type="submit" disabled={loading}>
          {loading ? "Creating..." : "Create User"}
        </button>
      </form>

      <div className="users">
        <h2>Users ({users.length})</h2>
        {users.map(user => (
          <div key={user.id} className="user-card">
            <div>
              <strong>{user.name}</strong>
              <br />
              <span>{user.email}</span>
            </div>
            <button onClick={() => deleteUser(user.id)} className="delete-btn">
              Delete
            </button>
          </div>
        ))}
      </div>
    </div>
  );
}
```

```css title="src/styles.css" icon="file-code"
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #f5f5f5;
  color: #333;
}

.container {
  max-width: 800px;
  margin: 0 auto;
  padding: 2rem;
}

h1 {
  color: #2563eb;
  margin-bottom: 2rem;
}

.form {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  margin-bottom: 2rem;
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.form input {
  flex: 1;
  min-width: 200px;
  padding: 0.75rem;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.form button {
  padding: 0.75rem 1.5rem;
  background: #2563eb;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.form button:hover {
  background: #1d4ed8;
}

.form button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.users {
  background: white;
  padding: 1.5rem;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.user-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  border-bottom: 1px solid #eee;
}

.user-card:last-child {
  border-bottom: none;
}

.delete-btn {
  padding: 0.5rem 1rem;
  background: #dc2626;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.delete-btn:hover {
  background: #b91c1c;
}
```

## æœ€ä½³å®è·µ

### é¡¹ç›®ç»“æ„

```
my-app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â””â”€â”€ UserList.tsx
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â””â”€â”€ components.css
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”œâ”€â”€ App.tsx
â”‚   â””â”€â”€ main.tsx
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ dashboard.html
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ users.ts
â”‚   â”‚   â””â”€â”€ auth.ts
â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â””â”€â”€ schema.sql
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ bunfig.toml
â””â”€â”€ package.json
```

### åŸºäºç¯å¢ƒçš„é…ç½®

```ts title="server/config.ts" icon="/icons/typescript.svg"
export const config = {
  development: process.env.NODE_ENV !== "production",
  port: process.env.PORT || 3000,
  database: {
    url: process.env.DATABASE_URL || "./dev.db",
  },
  cors: {
    origin: process.env.CORS_ORIGIN || "*",
  },
};
```

### é”™è¯¯å¤„ç†

```ts title="server/middleware.ts" icon="/icons/typescript.svg"
export function errorHandler(error: Error, req: Request) {
  console.error("Server error:", error);

  if (process.env.NODE_ENV === "production") {
    return Response.json({ error: "Internal server error" }, { status: 500 });
  }

  return Response.json(
    {
      error: error.message,
      stack: error.stack,
    },
    { status: 500 },
  );
}
```

### API å“åº”è¾…åŠ©å‡½æ•°

```ts title="server/utils.ts" icon="/icons/typescript.svg"
export function json(data: any, status = 200) {
  return Response.json(data, { status });
}

export function error(message: string, status = 400) {
  return Response.json({ error: message }, { status });
}

export function notFound(message = "Not found") {
  return error(message, 404);
}

export function unauthorized(message = "Unauthorized") {
  return error(message, 401);
}
```

### ç±»å‹å®‰å…¨

```ts title="types/api.ts" icon="/icons/typescript.svg"
export interface User {
  id: number;
  name: string;
  email: string;
  created_at: string;
}

export interface CreateUserRequest {
  name: string;
  email: string;
}

export interface ApiResponse<T> {
  data?: T;
  error?: string;
}
```

## éƒ¨ç½²

### ç”Ÿäº§æ„å»º

```bash terminal icon="terminal"
# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
bun build --target=bun --production --outdir=dist ./server/index.ts

# è¿è¡Œç”Ÿäº§æœåŠ¡å™¨
NODE_ENV=production bun dist/index.js
```

### Docker éƒ¨ç½²

```dockerfile title="Dockerfile" icon="docker"
FROM oven/bun:1 as base
WORKDIR /usr/src/app

# å®‰è£…ä¾èµ–
COPY package.json bun.lockb ./
RUN bun install --frozen-lockfile

# å¤åˆ¶æºä»£ç 
COPY . .

# æ„å»ºåº”ç”¨
RUN bun build --target=bun --production --outdir=dist ./server/index.ts

# ç”Ÿäº§é˜¶æ®µ
FROM oven/bun:1-slim
WORKDIR /usr/src/app
COPY --from=base /usr/src/app/dist ./
COPY --from=base /usr/src/app/public ./public

EXPOSE 3000
CMD ["bun", "index.js"]
```

### ç¯å¢ƒå˜é‡

```ini title=".env.production" icon="file-code"
NODE_ENV=production
PORT=3000
DATABASE_URL=postgresql://user:pass@localhost:5432/myapp
CORS_ORIGIN=https://myapp.com
```

## ä»å…¶ä»–æ¡†æ¶è¿ç§»

### ä» Express + Webpack

```ts title="server.ts" icon="/icons/typescript.svg"
// ä¹‹å‰ (Express + Webpack)
app.use(express.static("dist"));
app.get("/api/users", (req, res) => {
  res.json(users);
});

// ä¹‹å (Bun å…¨æ ˆ)
serve({
  routes: {
    "/": homepage, // æ›¿ä»£ express.static
    "/api/users": {
      GET() {
        return Response.json(users);
      },
    },
  },
});
```

### ä» Next.js API è·¯ç”±

```ts title="server.ts" icon="/icons/typescript.svg"
// ä¹‹å‰ (Next.js)
export default function handler(req, res) {
  if (req.method === 'GET') {
    res.json(users);
  }
}

// ä¹‹å (Bun)
"/api/users": {
  GET() { return Response.json(users); }
}
```

## é™åˆ¶ä¸æœªæ¥è®¡åˆ’

### å½“å‰é™åˆ¶

- `bun build` CLI å°šæœªé›†æˆå…¨æ ˆåº”ç”¨
- æœªå®ç° API è·¯ç”±è‡ªåŠ¨å‘ç°
- æœªå†…ç½®æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰

### è§„åˆ’åŠŸèƒ½

- ä¸ `bun build` CLI é›†æˆ
- API ç«¯ç‚¹çš„åŸºäºæ–‡ä»¶çš„è·¯ç”±
- å†…ç½® SSR æ”¯æŒ
- å¢å¼ºçš„æ’ä»¶ç”Ÿæ€

<Note>æ­¤éƒ¨åˆ†ä»åœ¨å¼€å‘ä¸­ã€‚åŠŸèƒ½å’Œ API å¯èƒ½ä¼šéšç€ Bun çš„å‘å±•è€Œå˜åŠ¨ã€‚</Note>
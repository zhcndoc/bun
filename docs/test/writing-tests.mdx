---
title: "ç¼–å†™æµ‹è¯•"
description: "å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Bun å†…ç½®çš„ Jest å…¼å®¹ API ç¼–å†™æµ‹è¯•ï¼Œæ”¯æŒå¼‚æ­¥æµ‹è¯•ã€è¶…æ—¶å’Œå„ç§æµ‹è¯•ä¿®é¥°ç¬¦"
---

ä½¿ç”¨ä»å†…ç½®æ¨¡å— `bun:test` å¯¼å…¥çš„ç±»ä¼¼ Jest çš„ API æ¥å®šä¹‰æµ‹è¯•ã€‚é•¿æœŸæ¥çœ‹ï¼ŒBun ç›®æ ‡æ˜¯å®ç°å®Œå…¨çš„ Jest å…¼å®¹æ€§ï¼›ç›®å‰æ”¯æŒçš„ expect åŒ¹é…å™¨é›†åˆæœ‰é™ã€‚

## åŸºæœ¬ç”¨æ³•

å®šä¹‰ä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼š

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test("2 + 2", () => {
  expect(2 + 2).toBe(4);
});
```

### æµ‹è¯•åˆ†ç»„

ä½¿ç”¨ `describe` å°†æµ‹è¯•åˆ†ç»„åˆ°æµ‹è¯•å¥—ä»¶ä¸­ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test, describe } from "bun:test";

describe("ç®—æœ¯", () => {
  test("2 + 2", () => {
    expect(2 + 2).toBe(4);
  });

  test("2 * 2", () => {
    expect(2 * 2).toBe(4);
  });
});
```

### å¼‚æ­¥æµ‹è¯•

æµ‹è¯•å¯ä»¥æ˜¯å¼‚æ­¥çš„ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test("2 * 2", async () => {
  const result = await Promise.resolve(2 * 2);
  expect(result).toEqual(4);
});
```

æˆ–è€…ä½¿ç”¨ `done` å›è°ƒæ¥æ ‡è¯†æµ‹è¯•å®Œæˆã€‚å¦‚æœåœ¨æµ‹è¯•å®šä¹‰ä¸­åŒ…å«äº† `done` å›è°ƒå‚æ•°ï¼Œå¿…é¡»è°ƒç”¨å®ƒï¼Œå¦åˆ™æµ‹è¯•å°†æŒ‚èµ·ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test("2 * 2", done => {
  Promise.resolve(2 * 2).then(result => {
    expect(result).toEqual(4);
    done();
  });
});
```

## è¶…æ—¶

å¯é€šè¿‡ç»™ `test` ä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°æ•°å­—æ¥æŒ‡å®šå•ä¸ªæµ‹è¯•çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { test } from "bun:test";

test("wat", async () => {
  const data = await slowOperation();
  expect(data).toBe(42);
}, 500); // æµ‹è¯•å¿…é¡»åœ¨ <500ms å†…å®Œæˆ
```

åœ¨ `bun:test` ä¸­ï¼Œæµ‹è¯•è¶…æ—¶ä¼šæŠ›å‡ºä¸å¯æ•è·çš„å¼‚å¸¸ï¼Œå¼ºåˆ¶æµ‹è¯•åœæ­¢å¹¶åˆ¤å®šå¤±è´¥ã€‚ä¸æ­¤åŒæ—¶ï¼Œæµ‹è¯•ä¸­ç”Ÿæˆçš„ä»»ä½•å­è¿›ç¨‹ä¹Ÿä¼šè¢«æ€æ­»ï¼Œä»¥é¿å…åå°ç•™ä¸‹åƒµå°¸è¿›ç¨‹ã€‚

å¦‚æœæœªè¢«æ­¤è¶…æ—¶é€‰é¡¹æˆ– `jest.setDefaultTimeout()` è¦†ç›–ï¼Œæ¯ä¸ªæµ‹è¯•çš„é»˜è®¤è¶…æ—¶æ˜¯ 5000msï¼ˆ5 ç§’ï¼‰ã€‚

## é‡è¯•å’Œé‡å¤æ‰§è¡Œ

### test.retry

ä½¿ç”¨ `retry` é€‰é¡¹å¯åœ¨æµ‹è¯•å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•ã€‚åªè¦åœ¨æŒ‡å®šçš„å°è¯•æ¬¡æ•°å†…æˆåŠŸï¼Œæµ‹è¯•å³é€šè¿‡ã€‚é€‚åˆä¸ç¨³å®šã€å¶å°”å¤±è´¥çš„æµ‹è¯•ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { test } from "bun:test";

test(
  "ä¸ç¨³å®šçš„ç½‘ç»œè¯·æ±‚",
  async () => {
    const response = await fetch("https://example.com/api");
    expect(response.ok).toBe(true);
  },
  { retry: 3 }, // å¤±è´¥æ—¶æœ€å¤šé‡è¯•3æ¬¡
);
```

### test.repeats

ä½¿ç”¨ `repeats` é€‰é¡¹å¯æ— è§†æµ‹è¯•ç»“æœï¼Œé‡å¤è¿è¡Œæµ‹è¯•å¤šæ¬¡ã€‚åªè¦æœ‰ä»»ä¸€è½®å¤±è´¥ï¼Œå³åˆ¤å®šæµ‹è¯•å¤±è´¥ã€‚é€‚åˆæ£€æµ‹ä¸ç¨³å®šæµ‹è¯•æˆ–å‹åŠ›æµ‹è¯•ã€‚æ³¨æ„ï¼Œ`repeats: N` å®é™…è¿è¡Œæ¬¡æ•°ä¸º N+1ï¼ˆ1æ¬¡åˆå§‹ + Næ¬¡é‡å¤ï¼‰ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { test } from "bun:test";

test(
  "ç¡®ä¿æµ‹è¯•ç¨³å®š",
  () => {
    expect(Math.random()).toBeLessThan(1);
  },
  { repeats: 20 }, // æ€»è®¡è¿è¡Œ21æ¬¡ï¼ˆ1æ¬¡åˆå§‹ + 20æ¬¡é‡å¤ï¼‰
);
```

<Note>åŒä¸€ä¸ªæµ‹è¯•ä¸èƒ½åŒæ—¶ä½¿ç”¨ `retry` å’Œ `repeats`ã€‚</Note>

### ğŸ§Ÿ åƒµå°¸è¿›ç¨‹æ¸…ç†å™¨

å½“æµ‹è¯•è¶…æ—¶ä¸”é€šè¿‡ `Bun.spawn`ã€`Bun.spawnSync` æˆ– `node:child_process` ç”Ÿæˆçš„è¿›ç¨‹æœªè¢«æ€æ­»æ—¶ï¼ŒBun ä¼šè‡ªåŠ¨æ€æ­»å®ƒä»¬å¹¶åœ¨æ§åˆ¶å°æ‰“å°æ¶ˆæ¯ã€‚é˜²æ­¢è¶…æ—¶æµ‹è¯•ååƒµå°¸è¿›ç¨‹æ®‹ç•™åå°ã€‚

## æµ‹è¯•ä¿®é¥°ç¬¦

### test.skip

ä½¿ç”¨ `test.skip` è·³è¿‡å•ä¸ªæµ‹è¯•ã€‚è·³è¿‡çš„æµ‹è¯•ä¸ä¼šè¢«æ‰§è¡Œã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test.skip("wat", () => {
  // TODO: ä¿®å¤æ­¤å¤„
  expect(0.1 + 0.2).toEqual(0.3);
});
```

### test.todo

ä½¿ç”¨ `test.todo` æ ‡è®°æµ‹è¯•ä¸ºå¾…åŠçŠ¶æ€ï¼Œè¿™äº›æµ‹è¯•ä¸ä¼šè¢«æ‰§è¡Œã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
import { expect, test } from "bun:test";

test.todo("ä¿®å¤æ­¤å¤„", () => {
  myTestFunction();
});
```

è¦æ‰§è¡Œ todo æµ‹è¯•å¹¶æ‰¾å‡ºå“ªäº›æµ‹è¯•å·²é€šè¿‡ï¼Œå¯ä½¿ç”¨ `bun test --todo`ã€‚

```bash terminal icon="terminal"
bun test --todo
```

```
my.test.ts:
âœ— æœªå®ç°åŠŸèƒ½
  ^ è¯¥æµ‹è¯•è¢«æ ‡è®°ä¸º todoï¼Œä¸”é€šè¿‡ã€‚è¯·ç§»é™¤ `.todo` æˆ–ç¡®è®¤æµ‹è¯•æ˜¯å¦æ­£ç¡®ã€‚

 0 é€šè¿‡
 1 å¤±è´¥
 1 æ¬¡ expect() è°ƒç”¨
```

å¯ç”¨æ­¤å‚æ•°æ—¶ï¼Œå¤±è´¥çš„ todo æµ‹è¯•ä¸ä¼šå¯¼è‡´é”™è¯¯ï¼Œä½†é€šè¿‡çš„ todo æµ‹è¯•å°†è¢«æ ‡è®°ä¸ºå¤±è´¥ï¼Œæ–¹ä¾¿ä½ ç§»é™¤ todo æ ‡è®°æˆ–ä¿®å¤æµ‹è¯•ã€‚

### test.only

è¿è¡Œç‰¹å®šæµ‹è¯•æˆ–æµ‹è¯•å¥—ä»¶ï¼Œä½¿ç”¨ `test.only()` æˆ– `describe.only()`ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { test, describe } from "bun:test";

test("æµ‹è¯• #1", () => {
  // ä¸è¿è¡Œ
});

test.only("æµ‹è¯• #2", () => {
  // è¿è¡Œ
});

describe.only("ä»…æ­¤", () => {
  test("æµ‹è¯• #3", () => {
    // è¿è¡Œ
  });
});
```

ä»¥ä¸‹å‘½ä»¤åªä¼šæ‰§è¡Œæµ‹è¯• #2 å’Œ #3ã€‚

```bash terminal icon="terminal"
bun test --only
```

ä»¥ä¸‹å‘½ä»¤ä¼šæ‰§è¡Œæµ‹è¯• #1ã€#2 å’Œ #3ã€‚

```bash terminal icon="terminal"
bun test
```

### test.if

ä½¿ç”¨ `test.if()` æœ‰æ¡ä»¶åœ°è¿è¡Œæµ‹è¯•ã€‚å½“æ¡ä»¶ä¸ºçœŸæ—¶è¿è¡Œã€‚é€‚ç”¨äºä»…åœ¨ç‰¹å®šæ¶æ„æˆ–æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„æµ‹è¯•ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
test.if(Math.random() > 0.5)("æœ‰ä¸€åŠæ¦‚ç‡è¿è¡Œ", () => {
  // ...
});

const macOS = process.platform === "darwin";
test.if(macOS)("ä»…åœ¨ macOS è¿è¡Œ", () => {
  // ä»…åœ¨ macOS è¿è¡Œ
});
```

### test.skipIf

æ¡ä»¶è·³è¿‡æµ‹è¯•ï¼Œä½¿ç”¨ `test.skipIf()` æˆ– `describe.skipIf()`ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
const macOS = process.platform === "darwin";

test.skipIf(macOS)("ä»…åœ¨é macOS è¿è¡Œ", () => {
  // åœ¨é macOS è¿è¡Œ
});
```

### test.todoIf

æ¡ä»¶æ ‡è®°æµ‹è¯•ä¸º TODOï¼Œä½¿ç”¨ `test.todoIf()` æˆ– `describe.todoIf()`ã€‚åˆ‡æ¢ `skipIf` æˆ– `todoIf` å¯åŒºåˆ†â€œè¯¥ç›®æ ‡æ— æ•ˆâ€å’Œâ€œè®¡åˆ’ä½†æœªå®ç°â€çš„æ„å›¾ã€‚

```ts title="example.test.ts" icon="/icons/typescript.svg"
const macOS = process.platform === "darwin";

// TODO: ç›®å‰åªåœ¨ Linux ä¸Šå®ç°ã€‚
test.todoIf(macOS)("è¿è¡Œåœ¨ posix ç³»ç»Ÿä¸Š", () => {
  // åœ¨é macOS è¿è¡Œ
});
```

### test.failing

å½“ä½ çŸ¥é“æµ‹è¯•å½“å‰ä¼šå¤±è´¥ï¼Œä½†æƒ³è·Ÿè¸ªå®ƒå¹¶åœ¨å®ƒå¼€å§‹é€šè¿‡æ—¶è·å–é€šçŸ¥ï¼Œä½¿ç”¨ `test.failing()`ã€‚è¯¥ä¿®é¥°ç¬¦å¯¹æµ‹è¯•ç»“æœå–åï¼š

- æ ‡æœ‰ `.failing()` çš„å¤±è´¥æµ‹è¯•ä¼šè¢«è§†ä¸ºé€šè¿‡
- æ ‡æœ‰ `.failing()` çš„é€šè¿‡æµ‹è¯•ä¼šå¤±è´¥ï¼ˆå¹¶æç¤ºè¯¥æµ‹è¯•ç°åœ¨é€šè¿‡ï¼Œåº”ä¿®å¤ï¼‰

```ts math.test.ts icon="/icons/typescript.svg"
// å› æµ‹è¯•æ•…æ„å¤±è´¥ï¼Œè¿™é‡Œä¼šé€šè¿‡
test.failing("æ•°å­¦æœ‰é—®é¢˜", () => {
  expect(0.1 + 0.2).toBe(0.3); // ç”±äºæµ®ç‚¹ç²¾åº¦å¤±è´¥
});

// æµ‹è¯•é€šè¿‡ï¼Œä½†æœŸæœ›å¤±è´¥ï¼Œå› æ­¤æµ‹è¯•å¤±è´¥å¹¶æç¤ºä¿®å¤
test.failing("ä¿®å¤äº† bug", () => {
  expect(1 + 1).toBe(2); // é€šè¿‡ï¼Œä½†æˆ‘ä»¬é¢„æœŸå¤±è´¥
});
```

é€‚åˆè·Ÿè¸ªä½ è®¡åˆ’ä»¥åä¿®å¤çš„å·²çŸ¥é”™è¯¯ï¼Œæˆ–ç”¨äºæµ‹è¯•é©±åŠ¨å¼€å‘ã€‚

## æ¡ä»¶æµ‹è¯•ç”¨äº describe å—

æ¡ä»¶ä¿®é¥°ç¬¦ `.if()`ã€`.skipIf()` å’Œ `.todoIf()` ä¹Ÿå¯ä»¥ç”¨äº describe å—ï¼Œå½±å“å¥—ä»¶å†…çš„æ‰€æœ‰æµ‹è¯•ï¼š

```ts title="example.test.ts" icon="/icons/typescript.svg"
const isMacOS = process.platform === "darwin";

// ä»…åœ¨ macOS ä¸Šè¿è¡Œæ•´ä¸ªå¥—ä»¶
describe.if(isMacOS)("macOS ç‰¹æœ‰åŠŸèƒ½", () => {
  test("ç‰¹æ€§ A", () => {
    // ä»…åœ¨ macOS è¿è¡Œ
  });

  test("ç‰¹æ€§ B", () => {
    // ä»…åœ¨ macOS è¿è¡Œ
  });
});

// åœ¨ Windows ä¸Šè·³è¿‡æ•´ä¸ªå¥—ä»¶
describe.skipIf(process.platform === "win32")("Unix åŠŸèƒ½", () => {
  test("ç‰¹æ€§ C", () => {
    // Windows ä¸Šè·³è¿‡
  });
});

// åœ¨ Linux ä¸Šå°†æ•´ä¸ªå¥—ä»¶æ ‡è®°ä¸º TODO
describe.todoIf(process.platform === "linux")("å³å°†æ”¯æŒ Linux", () => {
  test("ç‰¹æ€§ D", () => {
    // Linux ä¸Šæ ‡è®°ä¸º TODO
  });
});
```

## å‚æ•°åŒ–æµ‹è¯•

### `test.each` å’Œ `describe.each`

ä½¿ç”¨ `test.each` å¯é’ˆå¯¹å¤šä¸ªæ•°æ®é›†è¿è¡Œç›¸åŒæµ‹è¯•ã€‚æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½ä¼šè¿è¡Œä¸€æ¬¡ã€‚

```ts title="math.test.ts" icon="/icons/typescript.svg"
const cases = [
  [1, 2, 3],
  [3, 4, 7],
];

test.each(cases)("%p + %p åº”è¯¥æ˜¯ %p", (a, b, expected) => {
  expect(a + b).toBe(expected);
});
```

ä¹Ÿå¯ä»¥ç”¨ `describe.each` åˆ›å»ºé’ˆå¯¹æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œä¸€æ¬¡çš„å‚æ•°åŒ–å¥—ä»¶ï¼š

```ts title="sum.test.ts" icon="/icons/typescript.svg"
describe.each([
  [1, 2, 3],
  [3, 4, 7],
])("add(%i, %i)", (a, b, expected) => {
  test(`è¿”å› ${expected}`, () => {
    expect(a + b).toBe(expected);
  });

  test(`ç»“æœå¤§äºæ¯ä¸ªå€¼`, () => {
    expect(a + b).toBeGreaterThan(a);
    expect(a + b).toBeGreaterThan(b);
  });
});
```

### å‚æ•°ä¼ é€’

å¦‚ä½•å°†å‚æ•°ä¼ é€’ç»™æµ‹è¯•å‡½æ•°ï¼Œä¾èµ–äºæµ‹è¯•ç”¨ä¾‹çš„ç»“æ„ï¼š

- å¦‚æœè¡¨æ ¼è¡Œæ˜¯æ•°ç»„ï¼ˆä¾‹å¦‚ `[1, 2, 3]`ï¼‰ï¼Œåˆ™æ¯ä¸ªå…ƒç´ ä½œä¸ºå•ç‹¬å‚æ•°ä¼ å…¥
- å¦‚æœè¡Œä¸æ˜¯æ•°ç»„ï¼ˆå¦‚å¯¹è±¡ï¼‰ï¼Œåˆ™ä½œä¸ºå•ä¸ªå‚æ•°ä¼ å…¥

```ts title="example.test.ts" icon="/icons/typescript.svg"
// æ•°ç»„é¡¹ä½œä¸ºå•ç‹¬å‚æ•°ä¼ å…¥
test.each([
  [1, 2, 3],
  [4, 5, 9],
])("add(%i, %i) = %i", (a, b, expected) => {
  expect(a + b).toBe(expected);
});

// å¯¹è±¡é¡¹ä½œä¸ºå•ä¸ªå‚æ•°ä¼ å…¥
test.each([
  { a: 1, b: 2, expected: 3 },
  { a: 4, b: 5, expected: 9 },
])("add($a, $b) = $expected", data => {
  expect(data.a + data.b).toBe(data.expected);
});
```

### æ ¼å¼åŒ–å ä½ç¬¦

æµ‹è¯•æ ‡é¢˜æ ¼å¼åŒ–æ”¯æŒä»¥ä¸‹å ä½ç¬¦ï¼š

| å ä½ç¬¦  | æè¿°                   |
| ------- | ---------------------- |
| `%p`    | pretty-format ç¾åŒ–è¾“å‡º |
| `%s`    | å­—ç¬¦ä¸²                 |
| `%d`    | æ•°å­—                   |
| `%i`    | æ•´æ•°                   |
| `%f`    | æµ®ç‚¹æ•°                 |
| `%j`    | JSON                   |
| `%o`    | å¯¹è±¡                   |
| `%#`    | æµ‹è¯•ç”¨ä¾‹ç´¢å¼•           |
| `%%`    | å•ä¸ªç™¾åˆ†å· (%)         |

#### ç¤ºä¾‹

```ts title="example.test.ts" icon="/icons/typescript.svg"
// åŸºæœ¬å ä½ç¬¦
test.each([
  ["hello", 123],
  ["world", 456],
])("å­—ç¬¦ä¸²: %s, æ•°å­—: %i", (str, num) => {
  // "å­—ç¬¦ä¸²: hello, æ•°å­—: 123"
  // "å­—ç¬¦ä¸²: world, æ•°å­—: 456"
});

// %p ç”¨äº pretty-format è¾“å‡º
test.each([
  [{ name: "Alice" }, { a: 1, b: 2 }],
  [{ name: "Bob" }, { x: 5, y: 10 }],
])("ç”¨æˆ· %pï¼Œæ•°æ® %p", (user, data) => {
  // "ç”¨æˆ· { name: 'Alice' }ï¼Œæ•°æ® { a: 1, b: 2 }"
  // "ç”¨æˆ· { name: 'Bob' }ï¼Œæ•°æ® { x: 5, y: 10 }"
});

// %# ç”¨äºç´¢å¼•
test.each(["apple", "banana"])("æ°´æœ #%# æ˜¯ %s", fruit => {
  // "æ°´æœ #0 æ˜¯ apple"
  // "æ°´æœ #1 æ˜¯ banana"
});
```

## æ–­è¨€è®¡æ•°

Bun æ”¯æŒéªŒè¯æµ‹è¯•æœŸé—´è°ƒç”¨çš„æ–­è¨€æ•°é‡ï¼š

### expect.hasAssertions()

ä½¿ç”¨ `expect.hasAssertions()` éªŒè¯æµ‹è¯•ä¸­è‡³å°‘è°ƒç”¨è¿‡ä¸€æ¬¡æ–­è¨€ï¼š

```ts title="example.test.ts" icon="/icons/typescript.svg"
test("å¼‚æ­¥å·¥ä½œè°ƒç”¨æ–­è¨€", async () => {
  expect.hasAssertions(); // å¦‚æœæ²¡æœ‰æ–­è¨€è°ƒç”¨ï¼Œæµ‹è¯•å¤±è´¥

  const data = await fetchData();
  expect(data).toBeDefined();
});
```

è¿™å¯¹äºå¼‚æ­¥æµ‹è¯•å°¤å…¶æœ‰ç”¨ï¼Œç¡®ä¿ä½ çš„æ–­è¨€çœŸæ­£æ‰§è¡Œäº†ã€‚

### expect.assertions(count)

ä½¿ç”¨ `expect.assertions(count)` éªŒè¯æµ‹è¯•ä¸­è°ƒç”¨äº†æŒ‡å®šæ•°é‡çš„æ–­è¨€ï¼š

```ts title="example.test.ts" icon="/icons/typescript.svg"
test("æ°å¥½ä¸¤ä¸ªæ–­è¨€", () => {
  expect.assertions(2); // å¦‚æœæ–­è¨€ä¸æ˜¯ç²¾ç¡®2ä¸ªåˆ™å¤±è´¥

  expect(1 + 1).toBe(2);
  expect("hello").toContain("ell");
});
```

å°¤å…¶é€‚åˆå¤æ‚å¼‚æ­¥ä»£ç ä¸­ç¡®ä¿æ‰€æœ‰æ–­è¨€éƒ½æ‰§è¡Œã€‚

## ç±»å‹æµ‹è¯•

Bun åŒ…å«ç”¨äºæµ‹è¯• TypeScript ç±»å‹çš„ `expectTypeOf`ï¼Œå…¼å®¹ Vitestã€‚

### expectTypeOf

<Warning>
  è¿™äº›å‡½æ•°åœ¨è¿è¡Œæ—¶ä¸æ‰§è¡Œä»»ä½•æ“ä½œ â€”â€” ä½ éœ€è¦å•ç‹¬è¿è¡Œ TypeScript æ¥éªŒè¯ç±»å‹æ£€æŸ¥ã€‚
</Warning>

`expectTypeOf` å‡½æ•°æä¾›ç±»å‹çº§åˆ«çš„æ–­è¨€ï¼Œç”± TypeScript çš„ç±»å‹æ£€æŸ¥å™¨æ£€æŸ¥ã€‚æµ‹è¯•ç±»å‹çš„æ–¹æ³•ï¼š

1. ä½¿ç”¨ `expectTypeOf` ç¼–å†™ç±»å‹æ–­è¨€
2. è¿è¡Œ `bunx tsc --noEmit` æ£€æŸ¥ç±»å‹æ˜¯å¦æ­£ç¡®

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { expectTypeOf } from "bun:test";

// åŸºæœ¬ç±»å‹æ–­è¨€
expectTypeOf<string>().toEqualTypeOf<string>();
expectTypeOf(123).toBeNumber();
expectTypeOf("hello").toBeString();

// å¯¹è±¡ç±»å‹åŒ¹é…
expectTypeOf({ a: 1, b: "hello" }).toMatchObjectType<{ a: number }>();

// å‡½æ•°ç±»å‹
function greet(name: string): string {
  return `Hello ${name}`;
}

expectTypeOf(greet).toBeFunction();
expectTypeOf(greet).parameters.toEqualTypeOf<[string]>();
expectTypeOf(greet).returns.toEqualTypeOf<string>();

// æ•°ç»„ç±»å‹
expectTypeOf([1, 2, 3]).items.toBeNumber();

// Promise ç±»å‹
expectTypeOf(Promise.resolve(42)).resolves.toBeNumber();
```

å®Œæ•´çš„ `expectTypeOf` åŒ¹é…å™¨æ–‡æ¡£è¯·å‚è€ƒ [API å‚è€ƒ](https://bun.com/reference/bun/test/expectTypeOf)ã€‚

## åŒ¹é…å™¨

Bun å·²å®ç°ä»¥ä¸‹åŒ¹é…å™¨ã€‚å®Œå…¨å…¼å®¹ Jest æ­£åœ¨è§„åˆ’ä¸­ï¼›[è¿›åº¦è·Ÿè¸ª](https://github.com/oven-sh/bun/issues/1825)ã€‚

### åŸºæœ¬åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨              |
| ---- | ------------------- |
| âœ…   | `.not`              |
| âœ…   | `.toBe()`           |
| âœ…   | `.toEqual()`        |
| âœ…   | `.toBeNull()`       |
| âœ…   | `.toBeUndefined()`  |
| âœ…   | `.toBeNaN()`        |
| âœ…   | `.toBeDefined()`    |
| âœ…   | `.toBeFalsy()`      |
| âœ…   | `.toBeTruthy()`     |
| âœ…   | `.toStrictEqual()`  |

### å­—ç¬¦ä¸²å’Œæ•°ç»„åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                  |
| ---- | ----------------------- |
| âœ…   | `.toContain()`           |
| âœ…   | `.toHaveLength()`        |
| âœ…   | `.toMatch()`             |
| âœ…   | `.toContainEqual()`      |
| âœ…   | `.stringContaining()`    |
| âœ…   | `.stringMatching()`      |
| âœ…   | `.arrayContaining()`     |

### å¯¹è±¡åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                   |
| ---- | ------------------------ |
| âœ…   | `.toHaveProperty()`      |
| âœ…   | `.toMatchObject()`       |
| âœ…   | `.toContainAllKeys()`    |
| âœ…   | `.toContainValue()`      |
| âœ…   | `.toContainValues()`     |
| âœ…   | `.toContainAllValues()`  |
| âœ…   | `.toContainAnyValues()`  |
| âœ…   | `.objectContaining()`    |

### æ•°å­—åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                    |
| ---- | ------------------------- |
| âœ…   | `.toBeCloseTo()`           |
| âœ…   | `.closeTo()`               |
| âœ…   | `.toBeGreaterThan()`       |
| âœ…   | `.toBeGreaterThanOrEqual()`|
| âœ…   | `.toBeLessThan()`          |
| âœ…   | `.toBeLessThanOrEqual()`   |

### å‡½æ•°å’Œç±»åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨              |
| ---- | ------------------- |
| âœ…   | `.toThrow()`        |
| âœ…   | `.toBeInstanceOf()` |

### Promise åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨          |
| ---- | -------------- |
| âœ…   | `.resolves()`   |
| âœ…   | `.rejects()`    |

### æ¨¡æ‹Ÿå‡½æ•°åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                       |
| ---- | ----------------------------|
| âœ…   | `.toHaveBeenCalled()`        |
| âœ…   | `.toHaveBeenCalledTimes()`   |
| âœ…   | `.toHaveBeenCalledWith()`    |
| âœ…   | `.toHaveBeenLastCalledWith()`|
| âœ…   | `.toHaveBeenNthCalledWith()` |
| âœ…   | `.toHaveReturned()`          |
| âœ…   | `.toHaveReturnedTimes()`     |
| âœ…   | `.toHaveReturnedWith()`      |
| âœ…   | `.toHaveLastReturnedWith()`  |
| âœ…   | `.toHaveNthReturnedWith()`   |

### å¿«ç…§åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨                              |
| ---- | ---------------------------------- |
| âœ…   | `.toMatchSnapshot()`               |
| âœ…   | `.toMatchInlineSnapshot()`         |
| âœ…   | `.toThrowErrorMatchingSnapshot()`  |
| âœ…   | `.toThrowErrorMatchingInlineSnapshot()` |

### å·¥å…·åŒ¹é…å™¨

| çŠ¶æ€ | åŒ¹é…å™¨            |
| ---- | ----------------- |
| âœ…   | `.extend`         |
| âœ…   | `.anything()`     |
| âœ…   | `.any()`          |
| âœ…   | `.assertions()`   |
| âœ…   | `.hasAssertions()`|

### æœªå®ç°

| çŠ¶æ€ | åŒ¹é…å™¨                     |
| ---- | -------------------------- |
| âŒ   | `.addSnapshotSerializer()` |

## æœ€ä½³å®è·µ

### ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°

```ts title="example.test.ts" icon="/icons/typescript.svg"
// å¥½çš„ç¤ºä¾‹
test("åº”è®¡ç®—å¤šä¸ªå•†å“å«ç¨æ€»ä»·", () => {
  // æµ‹è¯•å®ç°
});

// é¿å…
test("ä»·æ ¼è®¡ç®—", () => {
  // æµ‹è¯•å®ç°
});
```

### åˆ†ç»„ç›¸å…³æµ‹è¯•

```ts title="auth.test.ts" icon="/icons/typescript.svg"
describe("ç”¨æˆ·è®¤è¯", () => {
  describe("æœ‰æ•ˆå‡­è¯æ—¶", () => {
    test("åº”è¿”å›ç”¨æˆ·æ•°æ®", () => {
      // æµ‹è¯•å®ç°
    });

    test("åº”è®¾ç½®è®¤è¯ä»¤ç‰Œ", () => {
      // æµ‹è¯•å®ç°
    });
  });

  describe("æ— æ•ˆå‡­è¯æ—¶", () => {
    test("åº”æŠ›å‡ºè®¤è¯é”™è¯¯", () => {
      // æµ‹è¯•å®ç°
    });
  });
});
```

### ä½¿ç”¨åˆé€‚çš„åŒ¹é…å™¨

```ts title="auth.test.ts" icon="/icons/typescript.svg"
// å¥½çš„ç¤ºä¾‹ï¼šä½¿ç”¨å…·ä½“åŒ¹é…å™¨
expect(users).toHaveLength(3);
expect(user.email).toContain("@");
expect(response.status).toBeGreaterThanOrEqual(200);

// é¿å…ï¼šå°†é€»è¾‘è¡¨è¾¾å¼ç”¨ toBe åŒ…è£¹
expect(users.length === 3).toBe(true);
expect(user.email.includes("@")).toBe(true);
expect(response.status >= 200).toBe(true);
```

### æµ‹è¯•é”™è¯¯æƒ…å†µ

```ts title="example.test.ts" icon="/icons/typescript.svg"
test("æ— æ•ˆè¾“å…¥åº”æŠ›å‡ºé”™è¯¯", () => {
  expect(() => {
    validateEmail("not-an-email");
  }).toThrow("Invalid email format");
});

test("åº”å¤„ç†å¼‚æ­¥é”™è¯¯", async () => {
  await expect(async () => {
    await fetchUser("invalid-id");
  }).rejects.toThrow("User not found");
});
```

### ä½¿ç”¨åˆå§‹åŒ–å’Œæ¸…ç†

```ts title="example.test.ts" icon="/icons/typescript.svg"
import { beforeEach, afterEach, test } from "bun:test";

let testUser;

beforeEach(() => {
  testUser = createTestUser();
});

afterEach(() => {
  cleanupTestUser(testUser);
});

test("åº”æ›´æ–°ç”¨æˆ·èµ„æ–™", () => {
  // åœ¨æµ‹è¯•ä¸­ä½¿ç”¨ testUser
});
```
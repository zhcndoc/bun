---
title: Bun 运行时
description: 使用 Bun 的快速运行时执行 JavaScript/TypeScript 文件、package.json 脚本及可执行程序包。
---

import Run from "/snippets/cli/run.mdx";

Bun 运行时旨在快速启动与高效运行。

底层，Bun 使用了由 Apple 为 Safari 开发的 [JavaScriptCore 引擎](https://developer.apple.com/documentation/javascriptcore)。在大多数情况下，启动和运行性能均优于 Node.js 和基于 Chromium 浏览器使用的 V8 引擎。其转译器与运行时均用现代高性能语言 Zig 编写。在 Linux 上，启动速度比 Node.js 快 [4 倍](https://twitter.com/jarredsumner/status/1499225725492076544)。

| 命令            | 时间     |
| --------------- | -------- |
| `bun hello.js`  | `5.2ms`  |
| `node hello.js` | `25.1ms` |

此基准测试基于 Linux 上运行一个简单的 Hello World 脚本

## 运行文件

使用 `bun run` 执行源文件。

```bash terminal icon="terminal"
bun run index.js
```

Bun 开箱即用支持 TypeScript 和 JSX。每个文件由 Bun 快速的本地转译器即时转译后执行。

```bash terminal icon="terminal"
bun run index.js
bun run index.jsx
bun run index.ts
bun run index.tsx
```

或者，你可以省略 `run` 关键字，使用裸命令，行为完全相同。

```bash terminal icon="terminal"
bun index.tsx
bun index.js
```

### `--watch`

使用 `--watch` 标志可以以监听模式运行文件。

```bash terminal icon="terminal"
bun --watch run index.tsx
```

<Note>
使用 `bun run` 时，Bun 的标志如 `--watch` 应紧跟在 `bun` 后面。

```bash
bun --watch run dev # ✔️ 推荐这样写
bun run dev --watch # ❌ 不推荐这样写
```

命令末尾的标志会被忽略，并传递给 `"dev"` 脚本本身。

</Note>

## 运行 `package.json` 脚本

<Note>
与 `npm run <script>` 或 `yarn <script>` 类似
</Note>

```sh
bun [bun 标志] run <script> [脚本标志]
```

你的 `package.json` 可以定义很多对应 shell 命令的命名 `"scripts"`。

```json package.json icon="file-json"
{
  // ... 其他字段
  "scripts": {
    "clean": "rm -rf dist && echo 'Done.'",
    "dev": "bun server.ts"
  }
}
```

用 `bun run <script>` 执行这些脚本。

```bash terminal icon="terminal"
bun run clean
rm -rf dist && echo 'Done.'
```

```txt
Cleaning...
Done.
```

Bun 在子 shell 中执行脚本命令。在 Linux 和 macOS 上，按顺序检查并使用第一个找到的 shell: `bash`、`sh`、`zsh`。在 Windows 上，Bun 使用 [bun shell](/runtime/shell) 来支持类 bash 语法和许多常见命令。

<Note>⚡️ Linux 上 `npm run` 的启动时间约为 170ms；Bun 仅需 `6ms`。</Note>

脚本也可用更简洁的命令 `bun <script>` 运行，然而如果名称与 Bun 内置命令冲突，内置命令优先。此时请使用更明确的 `bun run <script>` 执行包脚本。

```bash terminal icon="terminal"
bun run dev
```

要查看可用脚本列表，无需参数直接运行 `bun run`。

```bash terminal icon="terminal"
bun run
```

```txt
quickstart scripts:

 bun run clean
   rm -rf dist && echo 'Done.'

 bun run dev
   bun server.ts

2 scripts
```

Bun 支持生命周期钩子。例如，`bun run clean` 会执行 `preclean` 和 `postclean`（如果定义）。若 `pre<script>` 失败，Bun 不会执行主脚本。

### `--bun`

通常 `package.json` 脚本会引用本地安装的 CLI，如 `vite` 或 `next`。这些 CLI 常是带有 [shebang](<https://en.wikipedia.org/wiki/Shebang_(Unix)>) 的 JavaScript 文件，表明用 `node` 执行。

```js cli.js icon="/icons/javascript.svg"
#!/usr/bin/env node

// do stuff
```

默认情况下，Bun 会尊重此 shebang，用 `node` 执行该脚本。你可用 `--bun` 标志覆写此行为。对于基于 Node.js 的 CLI，将用 Bun 代替 Node.js 执行。

```bash terminal icon="terminal"
bun run --bun vite
```

### 过滤执行

在包含多个包的 monorepo 中，可以用 `--filter` 参数一次执行多个包中的脚本。

使用 `bun run --filter <name_pattern> <script>` 使 `<script>` 在所有包名匹配 `<name_pattern>` 的包内执行。

例如，若有包含名为 `foo`、`bar` 和 `baz` 的包子目录，运行

```bash terminal icon="terminal"
bun run --filter 'ba*' <script>
```

会在 `bar` 和 `baz` 中执行 `<script>`，而不会在 `foo` 中执行。

更多详情见文档页 [filter](/pm/filter#running-scripts-with-filter)。

## `bun run -` 从 stdin 管道执行代码

`bun run -` 允许从标准输入读取 JavaScript、TypeScript、TSX 或 JSX 代码，并执行，无需先写入临时文件。

```bash terminal icon="terminal"
echo "console.log('Hello')" | bun run -
```

```txt
Hello
```

你也可以用 `bun run -` 把文件重定向给 Bun。例如，把 `.js` 文件当作 `.ts` 文件运行：

```bash terminal icon="terminal"
echo "console.log!('This is TypeScript!' as any)" > secretly-typescript.js
bun run - < secretly-typescript.js
```

```txt
This is TypeScript!
```

为方便起见，使用 `bun run -` 时，所有代码均视为带 JSX 支持的 TypeScript。

## `bun run --console-depth`

用 `--console-depth` 标志控制 `console.log()` 输出中对象检查的深度。

```bash terminal icon="terminal"
bun --console-depth 5 run index.tsx
```

此设置决定 `console.log()` 中显示对象的嵌套层数。默认深度是 `2`。更高的值显示更多嵌套属性，但复杂对象输出可能较冗长。

```ts console.ts icon="/icons/typescript.svg"
const nested = { a: { b: { c: { d: "deep" } } } };
console.log(nested);
// --console-depth 2 (默认): { a: { b: [Object] } }
// --console-depth 4: { a: { b: { c: { d: 'deep' } } } }
```

## `bun run --smol`

在内存受限环境中，使用 `--smol` 标志以降低内存使用，但会降低性能。

```bash terminal icon="terminal"
bun --smol run index.tsx
```

这会导致垃圾回收更频繁运行，可能减慢执行速度。但在内存有限环境中很有用。Bun 会基于可用内存（考虑 cgroups 和其他内存限制）自动调整垃圾回收堆大小，有无 `--smol` 标志，故此选项主要适合希望堆增长更缓慢的情况。

## 解析顺序

绝对路径及以 `./` 或 `.\\` 开头的路径总是作为源文件执行。除非使用 `bun run`，运行带允许扩展名的文件优先使用该文件，而非 package.json 脚本。

当存在同名 package.json 脚本与文件时，`bun run` 优先执行 package.json 脚本。完整解析顺序为：

1. package.json 脚本，例如 `bun run build`
2. 源文件，例如 `bun run src/main.js`
3. 项目包中的二进制文件，例如 `bun add eslint && bun run eslint`
4. （仅 `bun run`）系统命令，例如 `bun run ls`

---

<Run />
---
title: åœ¨ AWS Lambda ä¸Šéƒ¨ç½² Bun åº”ç”¨
sidebarTitle: åœ¨ AWS Lambda ä¸Šéƒ¨ç½²
mode: center
---

[AWS Lambda](https://aws.amazon.com/lambda/) æ˜¯ä¸€é¡¹æ— æœåŠ¡å™¨è®¡ç®—æœåŠ¡ï¼Œå…è®¸æ‚¨æ— éœ€é…ç½®æˆ–ç®¡ç†æœåŠ¡å™¨å³å¯è¿è¡Œä»£ç ã€‚

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `Dockerfile` å°† Bun HTTP æœåŠ¡å™¨éƒ¨ç½²åˆ° AWS Lambdaã€‚

<Note>
	ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»å…·å¤‡ï¼š

    	- ä¸€ä¸ªå‡†å¤‡å¥½éƒ¨ç½²çš„ Bun åº”ç”¨
    	- ä¸€ä¸ª [AWS è´¦æˆ·](https://aws.amazon.com/)
    	- å·²å®‰è£…å¹¶é…ç½®å¥½çš„ [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html)
    	- å·²å®‰è£…å¹¶æ·»åŠ åˆ° `PATH` çš„ [Docker](https://docs.docker.com/get-started/get-docker/)

</Note>

---

<Steps>
	<Step title="åˆ›å»ºä¸€ä¸ªæ–°çš„ Dockerfile">
		ç¡®ä¿æ‚¨å¤„äºé¡¹ç›®ç›®å½•ä¸‹ï¼Œç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªæ–°çš„ `Dockerfile`ã€‚æ­¤æ–‡ä»¶åŒ…å«åˆå§‹åŒ–å®¹å™¨ã€å°†æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨ã€å®‰è£…ä¾èµ–ä»¥åŠå¯åŠ¨åº”ç”¨çš„æŒ‡ä»¤ã€‚

    	```docker Dockerfile icon="docker"
    	# ä½¿ç”¨å®˜æ–¹ AWS Lambda é€‚é…å™¨é•œåƒæ¥å¤„ç† Lambda è¿è¡Œæ—¶
    	FROM public.ecr.aws/awsguru/aws-lambda-adapter:0.9.0 AS aws-lambda-adapter

    	# ä½¿ç”¨å®˜æ–¹ Bun é•œåƒæ¥è¿è¡Œåº”ç”¨
    	FROM oven/bun:debian AS bun_latest

    	# å°† Lambda é€‚é…å™¨å¤åˆ¶åˆ°å®¹å™¨ä¸­
    	COPY --from=aws-lambda-adapter /lambda-adapter /opt/extensions/lambda-adapter

    	# è®¾ç½®ç«¯å£ä¸º 8080ï¼ŒAWS Lambda é€‚é…å™¨éœ€è¦æ­¤ç«¯å£
    	ENV PORT=8080

    	# è®¾ç½®å·¥ä½œç›®å½•ä¸º `/var/task`ï¼Œè¿™æ˜¯ Lambda çš„é»˜è®¤å·¥ä½œç›®å½•
    	WORKDIR "/var/task"

    	# å¤åˆ¶ package.json å’Œ bun.lock åˆ°å®¹å™¨ä¸­
    	COPY package.json bun.lock ./

    	# å®‰è£…ä¾èµ–
    	RUN bun install --production --frozen-lockfile

    	# å¤åˆ¶å…¶ä½™åº”ç”¨æ–‡ä»¶åˆ°å®¹å™¨ä¸­
    	COPY . /var/task

    	# è¿è¡Œåº”ç”¨
    	CMD ["bun", "index.ts"]
    	```

    	<Note>
    		ç¡®ä¿å¯åŠ¨å‘½ä»¤å¯¹åº”æ‚¨çš„åº”ç”¨å…¥å£ç‚¹ã€‚å¦‚æœæ‚¨åœ¨ `package.json` ä¸­æœ‰å¯åŠ¨è„šæœ¬ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `CMD ["bun", "run", "start"]`ã€‚

    		è¯¥é•œåƒä¼šåœ¨å®¹å™¨å†…ä½¿ç”¨ Bun å®‰è£…ä¾èµ–å¹¶è¿è¡Œæ‚¨çš„åº”ç”¨ã€‚å¦‚æœæ‚¨çš„åº”ç”¨æ²¡æœ‰ä¾èµ–ï¼Œå¯ä»¥çœç•¥ `RUN bun install --production --frozen-lockfile` è¿™è¡Œã€‚
    	</Note>

    	åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ªæ–°çš„ `.dockerignore` æ–‡ä»¶ï¼Œé‡Œé¢åˆ—å‡ºåº”ä»å®¹å™¨é•œåƒä¸­ _æ’é™¤_ çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¾‹å¦‚ `node_modules`ã€‚è¿™æ ·å¯ä»¥è®©æ„å»ºæ›´å¿«ä¸”æ›´å°ï¼š

    	```docker .dockerignore icon="Docker"
    	node_modules
    	Dockerfile*
    	.dockerignore
    	.git
    	.gitignore
    	README.md
    	LICENSE
    	.vscode
    	.env
    	# ä»»ä½•å…¶ä»–æƒ³æ’é™¤çš„æ–‡ä»¶æˆ–ç›®å½•
    	```
    </Step>
    <Step title="æ„å»º Docker é•œåƒ">
    	ç¡®ä¿æ‚¨å¤„äºåŒ…å« `Dockerfile` çš„ç›®å½•ï¼Œç„¶åæ„å»º Docker é•œåƒã€‚æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†é•œåƒå‘½åä¸º `bun-lambda-demo`ï¼Œå¹¶æ ‡è®°ä¸º `latest`ã€‚

    	```bash terminal icon="terminal"
    	# cd /path/to/your/app
    	docker build --provenance=false --platform linux/amd64 -t bun-lambda-demo:latest .
    	```
    </Step>
    <Step title="åˆ›å»º ECR ä»“åº“">
    	è¦å°†é•œåƒæ¨é€åˆ° AWS Lambdaï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºä¸€ä¸ª [ECR ä»“åº“](https://aws.amazon.com/ecr/)ã€‚

    	è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†ä¼šï¼š
    	- åœ¨ `us-east-1` åŒºåŸŸåˆ›å»ºä¸€ä¸ªåä¸º `bun-lambda-demo` çš„ ECR ä»“åº“
    	- è·å–ä»“åº“ URIï¼Œå¹¶å°†å…¶å¯¼å‡ºä¸ºç¯å¢ƒå˜é‡ï¼ˆå¯é€‰ï¼Œä½†ä¾¿äºæ¥ä¸‹æ¥çš„æ­¥éª¤ï¼‰

    	```bash terminal icon="terminal"
    	export ECR_URI=$(aws ecr create-repository --repository-name bun-lambda-demo --region us-east-1 --query 'repository.repositoryUri' --output text)
    	echo $ECR_URI
    	```
    	```txt
    	[id].dkr.ecr.us-east-1.amazonaws.com/bun-lambda-demo
    	```

    	<Note>
    		å¦‚æœæ‚¨ä½¿ç”¨ IAM Identity Center (SSO) æˆ–ä¸º AWS CLI é…ç½®äº†å¤šä¸ª profileï¼Œéœ€è¦ä¸º AWS CLI å‘½ä»¤æ·»åŠ  `--profile` å‚æ•°ã€‚

    		ä¾‹å¦‚ï¼Œè‹¥æ‚¨çš„ profile åä¸º `my-sso-app`ï¼Œåˆ™ä½¿ç”¨ `--profile my-sso-app`ã€‚æ‚¨å¯é€šè¿‡ `aws configure list-profiles` æŸ¥çœ‹å¯ç”¨çš„ profileã€‚

    		```bash terminal icon="terminal"
    		export ECR_URI=$(aws ecr create-repository --repository-name bun-lambda-demo --region us-east-1 --profile my-sso-app --query 'repository.repositoryUri' --output text)
    		echo $ECR_URI
    		```
    	</Note>

    </Step>
    <Step title="è®¤è¯ç™»å½• ECR ä»“åº“">
    	ç™»å½•åˆ° ECR ä»“åº“ï¼š

    	```bash terminal icon="terminal"
    	aws ecr get-login-password --region us-east-1 | docker login --username AWS --password-stdin $ECR_URI
    	```
    	```txt
    	Login Succeeded
    	```

    	<Note>
    		è‹¥ä½¿ç”¨ profileï¼Œéœ€æ·»åŠ  `--profile` å‚æ•°ï¼š

    		```bash terminal icon="terminal"
    		aws ecr get-login-password --region us-east-1 --profile my-sso-app | docker login --username AWS --password-stdin $ECR_URI
    		```

    	</Note>

    </Step>
    <Step title="ä¸º Docker é•œåƒæ‰“æ ‡ç­¾å¹¶æ¨é€åˆ° ECR ä»“åº“">
    	ç¡®ä¿æ‚¨å¤„äºåŒ…å« `Dockerfile` çš„ç›®å½•ä¸‹ï¼Œç„¶åå¯¹ Docker é•œåƒä½¿ç”¨ ECR ä»“åº“çš„ URI æ‰“æ ‡ç­¾ã€‚

    	```bash terminal icon="terminal"
    	docker tag bun-lambda-demo:latest ${ECR_URI}:latest
    	```

    	æ¥ç€ï¼Œå°†é•œåƒæ¨é€åˆ° ECR ä»“åº“ã€‚

    	```bash terminal icon="terminal"
    	docker push ${ECR_URI}:latest
    	```
    </Step>
    <Step title="åˆ›å»º AWS Lambda å‡½æ•°">
    	æ‰“å¼€ **AWS æ§åˆ¶å°** > **Lambda** > [**åˆ›å»ºå‡½æ•°**](https://us-east-1.console.aws.amazon.com/lambda/home?region=us-east-1#/create/function?intent=authorFromImage) > é€‰æ‹© **å®¹å™¨æ˜ åƒ**

    	<Warning>è¯·ç¡®è®¤æ‚¨é€‰æ‹©äº†æ­£ç¡®çš„åŒºåŸŸï¼Œè¯¥é“¾æ¥é»˜è®¤ä¸º `us-east-1`ã€‚</Warning>

    	<Frame>
    	![åˆ›å»ºå‡½æ•°](/images/guides/lambda1.png)
    	</Frame>

    	ä¸ºå‡½æ•°å‘½åï¼Œä¾‹å¦‚ `my-bun-function`ã€‚
    </Step>
    <Step title="é€‰æ‹©å®¹å™¨æ˜ åƒ">
    	ç„¶åï¼Œå‰å¾€ **å®¹å™¨æ˜ åƒ URI** éƒ¨åˆ†ï¼Œç‚¹å‡» **æµè§ˆæ˜ åƒ**ã€‚é€‰æ‹©åˆšæ‰æ¨é€åˆ° ECR ä»“åº“çš„æ˜ åƒã€‚

    	<Frame>
    	![é€‰æ‹©å®¹å™¨ä»“åº“](/images/guides/lambda2.png)
    	</Frame>

    	æ¥ç€é€‰æ‹© `latest` æ ‡ç­¾çš„æ˜ åƒï¼Œç‚¹å‡» **é€‰æ‹©æ˜ åƒ**ã€‚

    	<Frame>
    	![é€‰æ‹©å®¹å™¨æ˜ åƒ](/images/guides/lambda3.png)
    	</Frame>
    </Step>
    <Step title="é…ç½®å‡½æ•°">
    	è¦è·å–å‡½æ•°çš„å…¬å…± URLï¼Œéœ€è¦å‰å¾€ **é™„åŠ é…ç½®** > **ç½‘ç»œ** > **å‡½æ•° URL**ã€‚

    	å°†å…¶è®¾ç½®ä¸º **å¯ç”¨**ï¼Œè®¤è¯ç±»å‹é€‰æ‹© **NONE**ã€‚

    	<Frame>
    		![è®¾ç½®å‡½æ•° URL](/images/guides/lambda4.png)
    	</Frame>
    </Step>
    <Step title="åˆ›å»ºå‡½æ•°">
    	ç‚¹å‡»é¡µé¢åº•éƒ¨çš„ **åˆ›å»ºå‡½æ•°**ï¼Œå‡½æ•°å³è¢«åˆ›å»ºã€‚

    	<Frame>
    		![åˆ›å»ºå‡½æ•°](/images/guides/lambda6.png)
    	</Frame>

    </Step>
    <Step title="è·å–å‡½æ•° URL">
    	å‡½æ•°åˆ›å»ºå®Œæˆåï¼Œæ‚¨ä¼šè¢«é‡å®šå‘åˆ°å‡½æ•°é¡µé¢ï¼Œåœ¨ **â€œå‡½æ•° URLâ€** éƒ¨åˆ†å¯ä»¥çœ‹åˆ°å‡½æ•°çš„ URLã€‚

    	<Frame>
    		![å‡½æ•° URL](/images/guides/lambda5.png)
    	</Frame>
    </Step>
    <Step title="æµ‹è¯•å‡½æ•°">
    	ğŸ¥³ æ‚¨çš„åº”ç”¨å·²ä¸Šçº¿ï¼è¦æµ‹è¯•å‡½æ•°ï¼Œæ‚¨å¯ä»¥å‰å¾€ **æµ‹è¯•** æ ‡ç­¾é¡µï¼Œæˆ–ç›´æ¥è°ƒç”¨å‡½æ•° URLã€‚

    	```bash terminal icon="terminal"
    	curl -X GET https://[your-function-id].lambda-url.us-east-1.on.aws/
    	```
    	```txt
    	Hello from Bun on Lambda!
    	```
    </Step>

</Steps>

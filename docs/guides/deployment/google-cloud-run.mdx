---
title: åœ¨ Google Cloud Run ä¸Šéƒ¨ç½² Bun åº”ç”¨
sidebarTitle: åœ¨ Google Cloud Run ä¸Šéƒ¨ç½²
mode: center
---

[Google Cloud Run](https://cloud.google.com/run) æ˜¯ä¸€ä¸ªæ‰˜ç®¡å¹³å°ï¼Œç”¨äºéƒ¨ç½²å’Œæ‰©å±•æ— æœåŠ¡å™¨åº”ç”¨ã€‚Google ä¼šä¸ºæ‚¨ç®¡ç†åŸºç¡€è®¾æ–½ã€‚

åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ `Dockerfile` å°† Bun HTTP æœåŠ¡å™¨éƒ¨ç½²åˆ° Google Cloud Runã€‚

<Note>
	åœ¨ç»§ç»­ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»å…·å¤‡ï¼š

    - å‡†å¤‡å¥½éƒ¨ç½²çš„ Bun åº”ç”¨
    - å·²å¯ç”¨è®¡è´¹çš„ [Google Cloud è´¦æˆ·](https://cloud.google.com/)
    - å·²å®‰è£…å¹¶é…ç½®å¥½ [Google Cloud CLI](https://cloud.google.com/sdk/docs/install)

</Note>

---

<Steps> 
<Step title={<span>åˆå§‹åŒ– <code>gcloud</code>ï¼Œé€‰æ‹©æˆ–åˆ›å»ºé¡¹ç›®</span>}>

ç¡®ä¿æ‚¨å·²ç»åˆå§‹åŒ–äº† Google Cloud CLIã€‚è¯¥å‘½ä»¤ä¼šè®©æ‚¨ç™»å½•ï¼Œå¹¶æç¤ºé€‰æ‹©å·²æœ‰é¡¹ç›®æˆ–åˆ›å»ºæ–°é¡¹ç›®ã€‚

æœ‰å…³ Google Cloud CLI çš„æ›´å¤šå¸®åŠ©ï¼Œè¯·å‚è§ [å®˜æ–¹æ–‡æ¡£](https://docs.cloud.google.com/sdk/gcloud/reference/init)ã€‚

```bash terminal icon="terminal"
gcloud init
```

```txt
æ¬¢è¿ï¼è¯¥å‘½ä»¤å°†å¼•å¯¼æ‚¨å®Œæˆ gcloud çš„é…ç½®ã€‚

æ‚¨å¿…é¡»ç™»å½•æ‰èƒ½ç»§ç»­ã€‚æ‚¨æ˜¯å¦è¦ç™»å½• (Y/n)ï¼Ÿ Y
æ‚¨å·²ç™»å½•ä¸º [email@example.com]ã€‚

è¯·é€‰æ‹©è¦ä½¿ç”¨çš„äº‘é¡¹ç›®ï¼š
 [1] existing-bun-app-1234
 [2] è¾“å…¥é¡¹ç›® ID
 [3] åˆ›å»ºæ–°é¡¹ç›®
è¯·è¾“å…¥æ•°å­—é€‰æ‹©æˆ–æ–‡æœ¬å€¼ï¼ˆå¿…é¡»ä¸åˆ—è¡¨é¡¹å®Œå…¨åŒ¹é…ï¼‰ï¼š3

è¯·è¾“å…¥é¡¹ç›® IDã€‚my-bun-app
æ‚¨å½“å‰çš„é¡¹ç›®å·²è®¾ç½®ä¸ºï¼š[my-bun-app]

Google Cloud CLI å·²é…ç½®å¹¶å‡†å¤‡ä½¿ç”¨ï¼
```

</Step>
<Step title="ï¼ˆå¯é€‰ï¼‰å°†é¡¹ç›®ä¿¡æ¯å­˜å‚¨åˆ°ç¯å¢ƒå˜é‡">
è®¾ç½®æ‚¨çš„é¡¹ç›® ID å’Œç¼–å·å˜é‡ï¼Œæ–¹ä¾¿åç»­æ­¥éª¤å¤ç”¨ã€‚

```bash terminal icon="terminal"
PROJECT_ID=$(gcloud projects list --format='value(projectId)' --filter='name="my bun app"')
PROJECT_NUMBER=$(gcloud projects list --format='value(projectNumber)' --filter='name="my bun app"')

echo $PROJECT_ID $PROJECT_NUMBER
```

```txt
my-bun-app-... [PROJECT_NUMBER]
```

</Step> 
<Step title="å…³è”è®¡è´¹è´¦æˆ·">
åˆ—å‡ºå¯ç”¨çš„è®¡è´¹è´¦æˆ·ï¼Œå¹¶æŠŠä¸€ä¸ªè´¦æˆ·å…³è”åˆ°æ‚¨çš„é¡¹ç›®ï¼š

```bash terminal icon="terminal"
gcloud billing accounts list
```

```txt
ACCOUNT_ID            NAME                OPEN  MASTER_ACCOUNT_ID
[BILLING_ACCOUNT_ID]  æˆ‘çš„è®¡è´¹è´¦æˆ·         True
```

å°†è®¡è´¹è´¦æˆ·å…³è”åˆ°é¡¹ç›®ã€‚å°† `[BILLING_ACCOUNT_ID]` æ›¿æ¢ä¸ºæ‚¨çš„è®¡è´¹è´¦æˆ· IDã€‚

```bash terminal icon="terminal"
gcloud billing projects link $PROJECT_ID --billing-account=[BILLING_ACCOUNT_ID]
```

```txt
billingAccountName: billingAccounts/[BILLING_ACCOUNT_ID]
billingEnabled: true
name: projects/my-bun-app-.../billingInfo
projectId: my-bun-app-...
```

</Step> 
<Step title="å¯ç”¨ API å¹¶é…ç½® IAM è§’è‰²"> 
æ¿€æ´»æ‰€éœ€æœåŠ¡å¹¶æˆäºˆ Cloud Build æƒé™ï¼š

```bash terminal icon="terminal"
gcloud services enable run.googleapis.com cloudbuild.googleapis.com
gcloud projects add-iam-policy-binding $PROJECT_ID \
  --member=serviceAccount:$PROJECT_NUMBER-compute@developer.gserviceaccount.com \
  --role=roles/run.builder
```

<Note>  
è¿™äº›å‘½ä»¤å¯ç”¨äº† Cloud Run (`run.googleapis.com`) å’Œ Cloud Build (`cloudbuild.googleapis.com`)ï¼Œè¿™æ˜¯ä»æºç éƒ¨ç½²æ‰€å¿…éœ€çš„ã€‚Cloud Run è¿è¡Œæ‚¨çš„å®¹å™¨åŒ–åº”ç”¨ï¼Œè€Œ Cloud Build è´Ÿè´£æ„å»ºå’Œæ‰“åŒ…å®ƒã€‚

IAM ç»‘å®šæˆäºˆ Compute Engine æœåŠ¡è´¦æˆ·ï¼ˆ`$PROJECT_NUMBER-compute@developer.gserviceaccount.com`ï¼‰æƒé™ï¼Œä»£è¡¨æ‚¨æ„å»ºå’Œéƒ¨ç½²é•œåƒã€‚

</Note>

</Step>
<Step title="æ·»åŠ  Dockerfile">
åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæ–°çš„ `Dockerfile`ã€‚è¯¥æ–‡ä»¶åŒ…å«åˆå§‹åŒ–å®¹å™¨ã€å¤åˆ¶æœ¬åœ°é¡¹ç›®æ–‡ä»¶ã€å®‰è£…ä¾èµ–å’Œå¯åŠ¨åº”ç”¨çš„æŒ‡ä»¤ã€‚

```docker Dockerfile icon="docker"
# ä½¿ç”¨å®˜æ–¹ Bun é•œåƒè¿è¡Œåº”ç”¨
FROM oven/bun:latest

# å¤åˆ¶ package.json å’Œ bun.lock åˆ°å®¹å™¨
COPY package.json bun.lock ./

# å®‰è£…ä¾èµ–
RUN bun install --production --frozen-lockfile

# å¤åˆ¶å…¶ä½™çš„åº”ç”¨æ–‡ä»¶åˆ°å®¹å™¨
COPY . .

# è¿è¡Œåº”ç”¨
CMD ["bun", "index.ts"]
```

<Note>
  è¯·ç¡®ä¿å¯åŠ¨å‘½ä»¤å¯¹åº”æ‚¨çš„åº”ç”¨å…¥å£ç‚¹ã€‚å¦‚æœæ‚¨åœ¨ package.json ä¸­æœ‰ start è„šæœ¬ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `CMD ["bun", "run", "start"]`ã€‚

æ­¤é•œåƒä¼šå®‰è£…ä¾èµ–å¹¶åœ¨å®¹å™¨å†…ç”¨ Bun è¿è¡Œæ‚¨çš„åº”ç”¨ã€‚å¦‚æœåº”ç”¨æ²¡æœ‰ä¾èµ–ï¼Œå¯ä»¥çœç•¥ `RUN bun install --production --frozen-lockfile` è¿™ä¸€è¡Œã€‚

</Note>

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºæ–°çš„ `.dockerignore` æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶åˆ—å‡ºåº” _æ’é™¤_ åœ¨å®¹å™¨é•œåƒä¹‹å¤–çš„æ–‡ä»¶å’Œç›®å½•ï¼Œæ¯”å¦‚ `node_modules`ï¼Œè¿™å¯ä»¥è®©æ„å»ºæ›´å¿«æ›´å°ï¼š

```docker .dockerignore icon="Docker"
node_modules
Dockerfile*
.dockerignore
.git
.gitignore
README.md
LICENSE
.vscode
.env
# å…¶ä»–æƒ³æ’é™¤çš„æ–‡ä»¶æˆ–ç›®å½•
```

</Step>
<Step title="éƒ¨ç½²æœåŠ¡"> 
ç¡®ä¿æ‚¨å¤„åœ¨åŒ…å« `Dockerfile` çš„ç›®å½•ä¸­ï¼Œç„¶åç›´æ¥ä»æœ¬åœ°æºç éƒ¨ç½²ï¼š

<Note>
  è¯·å°† `--region` æ ‡å¿—æ›´æ–°ä¸ºæ‚¨åå¥½çš„åŒºåŸŸã€‚æ‚¨ä¹Ÿå¯ä»¥çœç•¥æ­¤æ ‡å¿—ï¼Œåœ¨äº¤äº’å¼æç¤ºä¸­é€‰æ‹©åŒºåŸŸã€‚
</Note>

```bash terminal icon="terminal"
gcloud run deploy my-bun-app --source . --region=us-west1 --allow-unauthenticated
```

```txt
ä»æºç éƒ¨ç½²éœ€è¦ä¸€ä¸ª Artifact Registry Docker ä»“åº“æ¥å­˜å‚¨æ„å»ºåçš„å®¹å™¨ã€‚å°†ä¼šåœ¨åŒºåŸŸ [us-west1] åˆ›å»ºåä¸º
[cloud-run-source-deploy] çš„ä»“åº“ã€‚

æ˜¯å¦ç»§ç»­ (Y/n)? Y

ä½¿ç”¨ Dockerfile æ„å»ºå¹¶å°†å®¹å™¨éƒ¨ç½²åˆ° Cloud Run æœåŠ¡ [my-bun-app]ï¼Œé¡¹ç›® [my-bun-app-...]ï¼ŒåŒºåŸŸ [us-west1]
âœ“ æ„å»ºå’Œéƒ¨ç½²... å®Œæˆã€‚
  âœ“ éªŒè¯æœåŠ¡...
  âœ“ ä¸Šä¼ æºç ...
  âœ“ æ„å»ºå®¹å™¨... æ—¥å¿—å¯åœ¨ [https://console.cloud.google.com/cloud-build/builds...] æŸ¥çœ‹ã€‚
  âœ“ åˆ›å»ºä¿®è®¢ç‰ˆæœ¬...
  âœ“ è·¯ç”±æµé‡...
  âœ“ è®¾ç½® IAM ç­–ç•¥...
å®Œæˆã€‚
æœåŠ¡ [my-bun-app] ç‰ˆæœ¬ [my-bun-app-...] å·²éƒ¨ç½²ï¼Œæ­£åœ¨å¤„ç† 100% æµé‡ã€‚
æœåŠ¡ URLï¼šhttps://my-bun-app-....us-west1.run.app
```

</Step>
<Step title="è®¿é—®æ‚¨çš„åœ¨çº¿åº”ç”¨">

ğŸ‰ æ‚¨çš„ Bun åº”ç”¨ç°å·²ä¸Šçº¿ï¼

è®¿é—®æœåŠ¡ URLï¼ˆ`https://my-bun-app-....us-west1.run.app`ï¼‰ç¡®è®¤ä¸€åˆ‡æ­£å¸¸ã€‚

</Step>
</Steps>